<!DOCTYPE html>
<html>
    <meta name="theme-color" content="#2c3e50">

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AirStudio+</title>

    <meta name="twitter:site" content="@molsjeroen">
    <meta property="og:type" content="article">

    <meta name="twitter:card" content="summary">

    <meta property="og:title" content="Jeroen Mols">
    <meta property="twitter:title" content="Jeroen Mols">

    <meta name="twitter:description" content="Portfolio of Jeroen Mols, the Android developer you should hire.">
    <meta property="og:description" content="Portfolio of Jeroen Mols, the Android developer you should hire.">
    <meta property="description" content="Portfolio of Jeroen Mols, the Android developer you should hire.">

    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Portfolio of Jeroen Mols, the Android developer you should hire.">
    <link rel="canonical" href="http://jeroenmols.com/portfolio/2013/10/15/airstudio/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Icons -->
    <link rel="favicon-144-precomposed" sizes="144x144" href="http://jeroenmols.com/favicon-144-precomposed.png">
    <link rel="shortcut icon" href="http://jeroenmols.com/favicon.ico">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63356566-1', 'auto');
  ga('send', 'pageview');

</script>

    <body id="page-top" class="index">
       <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#page-top">Jeroen Mols</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li class="page-scroll">
                        <a href="/blog">Blog</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#about">About</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#portfolio">Portfolio</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#speaking">Speaking</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

        <!-- Header -->
    <header>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <img class="img-responsive" src="img/profile_round.png" alt="">
                    <div class="intro-text">
                        <span class="name">Jeroen Mols</span>
                        <hr class="star-light">
                        <span class="skills">Android Developer</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    
    <!-- Blog Section -->
    <section id="blog">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>Recent blogposts</h2>
                    <hr class="star-primary">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">      			
					<div class="row">
					
						
							<div class="col-lg-6">
								<div class="post">
									</br>

									
									<div class="blogpost-overlay-header" style="background-image: url(/img/blog/cyclinggps/cyclinggps.png)">
									<div class="blogpost-overlay-header-title">
									  

									<h1 class="blogpost-title">
									  <a href="/blog/2016/07/21/cyclinggps/">
									Turn Android into an awesome cycling GPS
									  </a>
									</h1>

									<span class="blogpost-date">21 Jul 2016</span>

									
									</div>
									</div>
									

								</div>
							</div>

						
						 
					
						
							<div class="col-lg-6">
								<div class="post">
									</br>

									
									<div class="blogpost-overlay-header" style="background-image: url(/img/blog/droidconde16talk/droidcondetalk.png)">
									<div class="blogpost-overlay-header-title">
									  

									<h1 class="blogpost-title">
									  <a href="/blog/2016/06/24/droidcondetalk/">
									Testing made sweet with a Mockito
									  </a>
									</h1>

									<span class="blogpost-date">24 Jun 2016</span>

									
									</div>
									</div>
									

								</div>
							</div>

						
						 
					
						
							<div class="col-lg-6">
								<div class="post">
									</br>

									
									<div class="blogpost-overlay-header" style="background-image: url(/img/blog/droidconde16/droidconde.png)">
									<div class="blogpost-overlay-header-title">
									  

									<h1 class="blogpost-title">
									  <a href="/blog/2016/06/18/droidconde/">
									Droidcon Berlin recap
									  </a>
									</h1>

									<span class="blogpost-date">18 Jun 2016</span>

									
									</div>
									</div>
									

								</div>
							</div>

						
						 
					
						
							<div class="col-lg-6">
								<div class="post">
									</br>

									
									<div class="blogpost-overlay-header" style="background-image: url(/img/blog/methodcount/methodcount.png)">
									<div class="blogpost-overlay-header-title">
									  

									<h1 class="blogpost-title">
									  <a href="/blog/2016/05/06/methodcount/">
									Efficiently reducing your method count
									  </a>
									</h1>

									<span class="blogpost-date">06 May 2016</span>

									
									</div>
									</div>
									

								</div>
							</div>

						
						 
					
						
						 
					
						
						 
					
						
						 
					
						
						 
					
						
						 
					
						
						 
					
						
						 
					
						
						 
					
					</div>
					</br>
					<p>For more interesting topics have a look at the <a href="http://jeroenmols.com/blog" target="blank">full blog</a>.</p>
			
            	</div>
            </div>
        </div>
    </section>

     <!-- About Section -->
    <section class="success" id="about">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>About</h2>
                    <hr class="star-light">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                <!-- <div class="col-lg-4 col-lg-offset-2"> -->
                    <p>Jeroen has  a real passion to build things, which continuously challenges him to experiment and learn. In the process he acquired his software skills and refocussed his master in Electrical engineering to become an Android developer. Starting off with highly technical prototypes for Wi-Fi connected products, he build his own file sharing platform (Wi-FileTransfer). One thing led to another and currently he drives the innovation for the official Philips Hue Android and iOS apps.</p>
                  </br>
                    <p>One of a kind, never-been-done before apps are what he enjoys most and complex systems, highly technical apps have become his expertise. Currently Jeroen helped realize three huge connected products, various high profile apps (e.g Tomorrowland festival app), actively contributes to open source (Landscape Video Camera) and loves interacting with the Android community.</p>
                    </br>
                <!-- </div>
                <div class="col-lg-4"> -->
                    <p>Key Strengths:
                        <ul>
                            <li>Excellent communicator</li>
                            <li>Architectural thinking – understanding the bigger picture</li>
                            <li>Agile methodologies (SCRUM)</li>
                            <li>Creative problem solver</li>
                            <li>Coaching and training</li>
                            <li>“Just do it” - mentality</li>
                            <li>Team player</li>
                        </ul>
                    </p>
                <!-- </div> -->
            </div>
            </div>
        </div>
    </section>

    
    <!-- Portfolio Grid Section -->
    <section id="portfolio">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>Portfolio</h2>
                    <hr class="star-primary">
                </div>
            </div>
            <div class="row">
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-nieuwsblad" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/Nieuwsblad_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-landscapevideocamera" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/LandscapeVideoCamera_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-saecoavanti" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/SaecoAvanti_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-lightingpos" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/HuePos_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-smartair" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/SmartAir_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-eventapp" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/eventapp_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-tomorrowland" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/Tomorrowland_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-airstudio" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/AirStudio_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-wifiletransfer" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/WiFileTransfer_poster.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
                    <div class="col-sm-4 portfolio-item">
                        <a href="#portfolioModal-videobox" class="portfolio-link" data-toggle="modal">
                            <div class="caption">
                                <div class="caption-content">
                                    <i class="fa fa-search-plus fa-3x"></i>
                                </div>
                            </div>
                            <img src="img/portfolio/Videodagboek_onepager.jpg" class="img-responsive" alt="image-alt">
                        </a>
                    </div>
                
            </div>
        </div>
    </section>
     <!-- About Section -->
    <section class="success" id="speaking">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>Speaking</h2>
                    <hr class="star-light">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                <!-- <div class="col-lg-4 col-lg-offset-2"> -->
                    <p>I'm always eager to share my technical knowledge with fellow developers. Don't hesitate to <a href="https://twitter.com/molsjeroen" target="blank">contact me on Twitter</a> if you would like me to speak at your event!</p>
                  </br>
                <!-- </div>
                <div class="col-lg-4"> -->
                    <p>Upcoming talks:
                        <ul>
                            <li>Big Android Barbeque Europe - Testing made sweet with a Mockito</li>
                            <li>Big Android Barbeque Europe - Maven library distribution</li>
                        </ul>
                    </p>

                    <p>2016:
                        <ul>
                            <li>Droidcon Berlin - <a href="https://speakerdeck.com/jeroenmols/testing-made-sweet-with-a-mockito" target="blank" class="success">Testing made sweet with a Mockito</a></li>
                            <li>Droidcon Italy - <a href="https://speakerdeck.com/jeroenmols/distribute-your-libraries-via-maven-even-privately" target="blank" class="success">Distribute your libraries via Maven, even privately</a></li>
                            <li>GDG Brussels - <a href="https://speakerdeck.com/jeroenmols/automated-library-distribution-to-maven" target="blank">Automated library distribution to Maven</a></li>
                        </ul>
                    </p>

                    <p>2015:
                        <ul>
                            <li>Droidcon Paris - <a href="https://speakerdeck.com/jeroenmols/distributing-to-a-public-or-private-maven-repository" target="blank">Distributing to a public or private Maven repository</a></li>
                        </ul>
                    </p>
                <!-- </div> -->
            </div>
            </div>
        </div>
    </section>




        <!-- Footer -->
    <footer class="text-center">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4">
                        <h3>Location</h3>
                        <p>
                            
                                Mol <br>
		                    
                                Antwerp <br>
		                    
                                Belgium <br>
		                    
                        </p>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>Around the Web</h3>
                        <ul class="list-inline">
                            
                            <li>
                                <a href="https://twitter.com/molsjeroen" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-twitter"></i></a>
                            </li>
		                    
                            <li>
                                <a href="https://stackoverflow.com/users/2771851/jmols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-stack-overflow"></i></a>
                            </li>
		                    
                            <li>
                                <a href="https://github.com/JeroenMols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-github"></i></a>
                            </li>
		                    
                            <li>
                                <a href="https://be.linkedin.com/pub/jeroen-mols/25/a62/995" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-linkedin"></i></a>
                            </li>
		                    
                            <li>
                                <a href="https://speakerdeck.com/jeroenmols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-file-pdf-o"></i></a>
                            </li>
		                    
                        </ul>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>Credits</h3>
                        <p>This website is based on the free Bootstrap <a href="http://startbootstrap.com/template-overviews/freelancer/">Freelancer theme</a>.</br> The blog is based on <a href="http://hyde.getpoole.com"/>Hyde</a></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; Jeroen Mols 2016
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visible-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

     <!-- Portfolio Modals -->
 
    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Turn Android into an awesome cycling GPS</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/cyclinggps/cyclinggps.png" class="img-responsive img-centered" alt="">
                            <p>Cycling is all about exploring: visiting new places and making existing routes more fun with better streets. So there must be an app that allows to plan your route and start cycling right? Think again... there is currently no solution that offers turn by turn navigation for cyclists.

As I had an old Android device laying around, I decided to repurpose that and convert it into a GPS that:

- tracks my activity
- imports gpx tracks created on my computer
- offers turn by turn navigation (screen + voice)

This blogpost will detail how I use [OsmAnd](https://play.google.com/store/apps/details?id=net.osmand) and [Dropsync](https://play.google.com/store/apps/details?id=com.ttxapps.dropsync) to create new tracks with minimal effort. Further I'll also describe the gear I use in order to make this work.

<br>

## Gear
<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/gear.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/gear.png" alt="Cycling GPS gear"></a></center>

To build your own GPS, you'll need the following:

1. Android phone - I use my Nexus 5, but any Android device will do
2. Bicycle GPS mount - I use [this one](http://www.dx.com/p/universal-bike-bicycle-mount-cell-phones-bracket-holder-stand-black-208712#.V5DBF5O7hBc)
3. Rainproof case - I use [these](http://www.dx.com/p/universal-waterproof-bag-case-cover-dry-bag-for-iphone-htc-translucent-3-pcs-318004#.V5DBRpO7hBe)

<br>

## Create tracks
To explore new places, you need a great tool to create cycling routes. I personally use [Strava](https://www.strava.com/) because it has a "global Heatmap" and also supports "segments" where most people cycle. It is a great way to figure out popular cycling streets and help you plan a great route. Note that you can do all of this using a free account, but with a [premium subscription](https://www.strava.com/premium) you will get lots more.

To create routes, just go to "My routes" and select "Create new route":

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/routes.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/routes.png" alt="Create a new route"></a></center>

The global Heatmap indicates where most people cycle:

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/heatmap.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/heatmap.png" alt="The global Heatmap indicates where most people cycle"></a></center>

Segments are often challenging parts to cycle, that contain a leaderboard:

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/segments.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/segments.png" alt="Segments are often challenging parts to cycle, that contain a leaderboard"></a></center>

Once you created a route, you can export it to a `gpx` file format. Note that it doesn't matter which GPS you choose to do the export.

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/export.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/export.png" alt="Tracks can be exported into a gpx file format"></a></center>
<br>

## Configure OsmAnd
[OsmAnd](https://play.google.com/store/apps/details?id=net.osmand) offers both turn by turn navigation and storing maps offline. This is ideal to save bandwidth or for phones without a sim card (like mine). It is completely free to use, but there is also a [premium version](https://play.google.com/store/apps/details?id=net.osmand.plus) if you want to support this awesome project.

Getting it to work with `gpx` files is tricky and hence I will guide you through it.

First of all install [OsmAnd](https://play.google.com/store/apps/details?id=net.osmand) (or [OsmAnd+](https://play.google.com/store/apps/details?id=net.osmand.plus)). When you open the app, press "skip" and don't download any maps. This is because they would end up in a private directory. Open the hamburger menu, go to "Settings" and open "General settings".

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand1.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand1.png" alt="Skip downloading maps and go to general settings"></a></center>

Now we're going to change the directory in which OsmAnd stores all of its files. Use "Data storage folder", click the "edit icon" and select "Shared memory" as the data storage folder. This will put all files in an "osmand" directory on the root of your internal storage. Accept the permission when promted to allow OsmAnd to create and write to that folder.

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand2.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand2.png" alt="Change the folder in which maps are downloaded to the shared folder"></a></center>

Next go ahead and download the maps for the areas in which you will be cycling. When prompted for a storage folder, again select "Shared memory".

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand3.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand3.png" alt="Download the maps you need to the shared folder"></a></center>

<br>

## Automatically sync tracks using Dropbox
Getting new tracks on your phone can be quite a hassle. Therefore we'll automate this process so you can add new tracks to your phone by only using your computer.

First of all, create a new folder in your [Dropbox](https://www.dropbox.com/) account called "Cycling".

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/dropbox.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/dropbox.png" alt="Dropbox folder that will contain all tracks"></a></center>

Then install the app [Dropsync](https://play.google.com/store/apps/details?id=com.ttxapps.dropsync) (or [Dropsync pro](https://play.google.com/store/apps/details?id=com.ttxapps.dropsync.pro)). Next configure it so that it automatically syncs any file you put in the Dropbox folder into the correct folder on the Android phone.

Open Dropsync, login with your Dropbox account and select "let me create my own folder pair". As the local folder choose "osmand/tracks" and as the remote folder "Cycling". Then select "Download mirror" as the sync method and enable sync. Save the changes and wait for the sync to complete.

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/dropsync.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/dropsync.png" alt="Configure Dropsync to put the GPX files in the correct folder on the Android phone"></a></center>

Now all you have to do is export a track from Strava, move it into the Dropbox folder and it will autmagically appear in OsmAnd on your GPS!

<br>

## Turn by turn navigation
Finally you're ready to start using your synced tracks for turn by turn navigation.

Open OsmAnd and press the "globe" icon in the top left corner. Scroll down a bit and select "GPX track..." to choose the track you want to display. Exit the screen and start navigation by pressing the "navigation" icon in the bottom left corner.

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand4.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand4.png" alt="Select a track (gpx file) and start navigation"></a></center>

Enjoy your turn by turn navigation!

<center><a href="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand5.png"><img src="{{ site.blogbaseurl }}img/blog/cyclinggps/osmand5.png" alt="Select a track (gpx file) and start navigation"></a></center>

<br>

## Tips and tricks
I'll update this section as I discover new handy features/tricks to make the GPS even more usefull.

- Remove the lockscreen: go to "Device Settings" > "Security" and set the "Screen lock" to "none". This will enable you to simply press the power key to turn on your screen.

<br>

## Wrap-up
In a few very simple steps we created a complete cycling GPS solution that provides turn by turn navigation and offline maps. Creating tracks is done using Strava and export using a Dropbox folder so that they automatically appear on your GPS device.

As always you can reach me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leave a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Testing made sweet with a Mockito</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/droidconde16talk/droidcondetalk.png" class="img-responsive img-centered" alt="">
                            <p>At Droidcon Berlin 2016 I had a great time talking about testing using the [Mockito](http://mockito.org/) framework. While the talk wasn't recorded unfortunately, the great folks at [Voice Republic](https://voicerepublic.com/series/droidcon-berlin-2016) recorded an audio version which you can listen to as a podcast or together with the slides.

<br>

## Talk

<script async class="speakerdeck-embed" data-id="061ea326e4b24a3aa961440fd699c481" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>

<iframe width="100%" height="32%" src="https://voicerepublic.com/embed/talks/testing-made-sweet-with-a-mockito" frameborder="0" scrolling="no" allowfullscreen></iframe>

The past year has been huge for Android testing: Testing support lib, fast JVM unit tests,... Having such great tools means writing tests is a breeze! All your apps currently have >80% code coverage, right? Yay! Or wait... is it really? Is all your common Android logic (networking, databases,...) tested? Do you isolate parts of your code base to keep your tests small? And what about providing relevant testing data?

In order to achieve this, you need to make use of mocks and stubs. And that's exactly what this talk will be about: What is a mock? What's the difference between a mock and a stub? Are mocks the only way to provide relevant data for your unit tests? What do I do with all the final classes/methods in the Android SDK? How do I architect my app to make it easier to test? ...

After having adopted TDD as my main development workflow for almost a year now, I feel comfortable saying everything can be tested. Its just a matter of having someone experience show you how.

<br>

## Code
A fully working sample project with all principles is available [on Github](https://github.com/JeroenMols/MockitoExample).

- [build.gradle](https://github.com/JeroenMols/MockitoExample/blob/master/app/build.gradle) file indicating how to configure Mockito
  - testCompile: for tests run on your computer in a JVM (src/test folder)
  - androidTestCompile: for tests run on an Android device (src/androidTest folder)
- [UserTest](https://github.com/JeroenMols/MockitoExample/blob/master/app/src/test/java/com/jeroenmols/mockitoexample/UserTest.java) class demonstrating Mockito usage
  - TLDR: JVM unit tests with mockito are easy to read and write
- [UserTestAndroid](https://github.com/JeroenMols/MockitoExample/blob/master/app/src/androidTest/java/com/jeroenmols/mockitoexample/UserTestAndroid.java) class demonstrating Mockito usage on Android device
  - TLDR: Mockito can be used on Android, but need to use V1 and dexmaker
- [HandlerWrapper](https://github.com/JeroenMols/MockitoExample/blob/master/app/src/main/java/com/jeroenmols/mockitoexample/HandlerWrapper.java) class indicating how to test final methods
  - TLDR: Wrap final or statics methods with a different non static/final method
- [TestUserData](https://github.com/JeroenMols/MockitoExample/blob/master/app/src/test/java/com/jeroenmols/mockitoexample/TestUserData.java) class indicating how to provide testing data for POJO objects
  - TLDR: Override all methods with default values instead of creating a mock and stubbing them out

  <br>

## Audience

<center><a href="{{ site.blogbaseurl }}img/blog/droidconde16talk/audience.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconde16talk/audience.jpg" alt="Quite some people interested in my talk"></a></center>
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Droidcon Berlin recap</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/droidconde16/droidconde.png" class="img-responsive img-centered" alt="">
                            <p>Having founded the entire Droidcon franchise in 2009, Droidcon Berlin is a magical conference to be at. Not only do they have an awesome lineup of speakers (including yours truly). But they also organize great after hour events. Further they're the first conference ever where I didn't have any Wi-Fi issues (looking at you #io16).

As there were four different tracks, it was obviously not possible to attend every session. But I did notice some general themes and would like to share my personal highlights with you.

<br>

## Architecture
While Android is maturing as a platform, developers are also professionalizing their applications. Every growing apps mean that testability, maintenance and refactoring is only increasing in importance.

My key takeaways:

- MVP is a UI pattern not an architecture
- All dependencies should point in one direction
- Don't be dogmatic
- Users don't care about your architecture

<br>

## IoT

<center><a href="{{ site.blogbaseurl }}img/blog/droidconde16/iotcoffee.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconde16/iotcoffee.jpg" alt="Philips Hue Coffee"></a></center>

Interest in IoT products is steadily increasing, but as a developer it is still not easy to create IoT apps. Properly handling things like Bluetooth LE keeps on being plagued by device specific issues. And seemingly simple problems like properly handling a user sign in are still extremely complex.

My key takeaways:

- When using BT LE, only support API 21 or higher
- Handle all bluetooth LE callbacks on separate HandlerThread
- Firebase can handle all sign in complexity for you

<br>

## Designing for the next billion

<center><a href="{{ site.blogbaseurl }}img/blog/droidconde16/nextbillion.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconde16/nextbillion.jpg" alt="Philips Hue Coffee"></a></center>

Where we used to be educated that "a developer phone is not a user phone", this message is now morphing towards people in emerging markets. Designing for such markets doesn't only require functional changes like developing for offline first, but it even requires you to completely think your UX.

My key takeaways:

- access to cheap fast internet is not a given
- battery life is even more precious in emerging countries
- understandable UX when smartphone is your first computer

<br>

## Other hot topics

<center><a href="{{ site.blogbaseurl }}img/blog/droidconde16/alphastates.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconde16/alphastates.jpg" alt="You can use alpha values for button states in XML"></a></center>


Besides these, also a lot of attention was spent on testing and tooling. There were great talks about styling, theming and creating custom views. And many sessions also dived deeper into optimizing your apps performance. Bit unfortunate that there weren't any more talks on the new Android N features.

My key takeaways:

- You can use alpha values for button states in XML
- Use overlay themes instead of changing text colors
- Tests should be fast, focussed and reliable
- It maybe worth to convert an existing app to RXJava, but keep it contained to particular layers. (e.g. Webservice)

<br>

## Sketchnoting

<center><a href="{{ site.blogbaseurl }}img/blog/droidconde16/sketchnoting.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconde16/sketchnoting.jpg" alt="Corey Leigh Latislaw creating a sketch note"></a></center>

Sketch notes are really awesome! In this, creative people summarize a talk into a very cool one pager. This doesn't only look great, but it's also by far the easiest way to get a high level view of a talk.

At Droidcon both [Corey Leigh Latislaw](https://twitter.com/corey_latislaw) and [Teresa Holfeld](https://twitter.com/TeresaHolfeld) were actively creating sketch notes. You should check their twitter feeds for the awesome content they created.

Just a sample:

<center><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Offline First by <a href="https://twitter.com/glynn_bird">@glynn_bird</a> at <a href="https://twitter.com/hashtag/droidconDe?src=hash">#droidconDe</a>. <a href="https://twitter.com/hashtag/sketchnote?src=hash">#sketchnote</a> <a href="https://t.co/SkeriMsigT">pic.twitter.com/SkeriMsigT</a></p>&mdash; Corey Leigh Latislaw (@corey_latislaw) <a href="https://twitter.com/corey_latislaw/status/743390864660135937">June 16, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></center>

<center><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Themes and Styles demystified: talk by <a href="https://twitter.com/chrisbanes">@chrisbanes</a> <a href="https://twitter.com/hashtag/droidconDE?src=hash">#droidconDE</a> <a href="https://twitter.com/hashtag/sketchnotes?src=hash">#sketchnotes</a> <a href="https://t.co/mXNcW8lGRS">pic.twitter.com/mXNcW8lGRS</a></p>&mdash; Teresa Holfeld (@TeresaHolfeld) <a href="https://twitter.com/TeresaHolfeld/status/743438928666034176">June 16, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></center>

Thanks for both of them for creating such great summaries.

<br>

## Conference slides
While the conference organizers will publish all slides very soon, I can image that quite a few people are already looking for a sneak preview. Hence I bundled everything I could already gather from socials.

- [Testing made sweet with a Mockito](https://speakerdeck.com/jeroenmols/testing-made-sweet-with-a-mockito) by Jeroen Mols
- [Reverse engineering is not just for hackers](https://speakerdeck.com/jonreeve/reverse-engineering-is-not-just-for-hackers) by Jon Reeve
- [Refactoring Plaid - A reactive MVP approach](https://speakerdeck.com/sockeqwe/refactoring-plaid-a-reactive-mvp-approach) by Hannes Dorfmann
- [Android & IoT](https://speakerdeck.com/aselims/android-and-iot-at-droidconde-16) by Selim Salman
- [Unit testing without Robolectric](http://www.slideshare.net/dpreussler/unit-testing-without-robolectric-droidcon-berlin-2016) by
Danny Preussler
- [#Perfmatters for Android](https://speakerdeck.com/alosdev/perfmatters-for-android-droidcon-berlin-2016) by Hasan Hosgel
- [Life of Android Enterprise Developers in the age of Android for Work](https://speakerdeck.com/nibble/life-of-android-enterprise-developers-in-the-age-of-android-for-work) by Pietro Maggi
- [The 2016 Android Developer Toolbox](http://www.slideshare.net/Nilhcem/the-2016-android-developer-toolbox-berlin) by Gautier Mechling
- [Practical Bluetooth Low Energy on Android](https://speakerdeck.com/erikhellman/practical-bluetooth-low-energy-on-android) by Erik Hellman
- [Contextual Communications And Why You Should Care](http://www.slideshare.net/MarcosPlacona/contextual-communications-and-why-you-should-care-droidcon-de) by Marcos Placona
- [Deep dive into Android Data Binding](https://speakerdeck.com/radzio/deep-dive-into-android-data-binding) by Radek Piekarz
- [Let's get physical](https://docs.google.com/presentation/d/1Fldq6lWkrVeBdDyPwMQ7jkItZ1m2XMpDXQzu3IwbSE8/edit#slide=id.p) by Albrecht Noll and Pascal Welsch
- [Testing Why? When? How?](http://www.slideshare.net/polanskitomasz) by Tomasz Polański
- [Adopting RxJava on Airbnb Android](https://speakerdeck.com/felipecsl/adopting-rxjava-on-airbnb-android) by Felipe Lima
- [Elegant?? Unit Testing](https://speakerdeck.com/guardiola31337/elegant-unit-testing-droidcon-berlin-2016) by Pablo Guardiola
- [Material design custom views](https://docs.google.com/presentation/d/1JaTb9KDMtE9-9g9zRIXKzLB5WwGVVEI8F-wGtNSo-0c/edit#slide=id.ge54df3a86_0_53) by Said Tahsin Dane
- [Android TV: Building apps with Google's Leanback Library](https://photos.google.com/share/AF1QipPpuNyuATl-Ae09WzlXkxyHXxoOxZ_-uXLKB4uALR3bG3vnpcYLl2UIAKoNYGzd-g?key=X0o2U3EyLVdRWkxfQm9hUG5uZGUtN0wwc2UwTnpB) by Joe Birch
- [Screenshot your Entire App](https://speakerdeck.com/scompt/screenshot-your-entire-app) by Edward Dale
- [Little helpers for Android development with Kotlin](http://www.slideshare.net/AgentK/little-helpers-for-android-development-with-kotlin) by Kai Koenig
- [Effective Android Development](https://speakerdeck.com/sergiiz/effective-android-development) by Sergii Zhuk
- [Android is the World Phone](https://speakerdeck.com/colabug/android-is-the-world-phone-droidcon-berlin) by Corey Latislaw
- [Loving lean layouts](https://speakerdeck.com/randomlytyping/babbq-2015-loving-lean-layouts) by Huyen Tue Dao
- [Let it flow - unidirectional data flow architecture on Android](https://speakerdeck.com/dorvaryn/let-it-flow) by Benjamin Augustin
- [We're all UX!](https://speakerdeck.com/lyslydia/were-all-ux) by Lydia Selimalhigazi and Caroline Smith
- [10 ways to analyse runtime failure using Classy Shark](http://www.slideshare.net/seamaster29/classshark-android-and-java-executables-browser) by Boris Farber

<br>

## Credits
Thanks to the entire Droidcon Berlin team for organizing such a great conference and to all sponsers for their support. Keep up the awesome job!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Efficiently reducing your method count</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/methodcount/methodcount.png" class="img-responsive img-centered" alt="">
                            <p>As green field projects are a rare breed, chances are that you've inherited a legacy code base. If you're as lucky as me, that code base has over 65k methods causing the build times to be boringly slow.

Today I would like to show how you can visualize your current method count and understand what libraries are eating up the largest part of that. Next it's time to reduce said method count and remove that nasty multidex solution once and for all.

<br>

## Visualizing method count
The easiest and most attractive way (imho) to visualize the method count is by using the [Dexcount Gradle Plugin](https://github.com/KeepSafe/dexcount-gradle-plugin). Applying it to your project is as easy as adding a classpath dependency to your root `build.gradle` and applying the plugin to your App `build.gradle`.

```groovy
// root build.gradle file
buildscript {
    repositories {
        jcenter() // or mavenCentral()
    }

    dependencies {
        classpath 'com.getkeepsafe.dexcount:dexcount-gradle-plugin:0.5.0'
    }
}
```

```groovy
// app build.gradle file (apply AFTER Android plugin)
apply plugin: 'com.getkeepsafe.dexcount'
```

Running a normal project build `./gradlew assembleDebug` will now print out the current method count in the console:

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_output.png"><img src="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_output.png" alt="Method count output of template project with full Google Play Services"></a></center>

and generate an interactive graphical report in the outputs folder `build/outputs/dexcount/debugChart`:

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/dexcount-googleplayservices/debugChart/index.html"><img src="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_graphic.gif" alt="Method count graphical output of template project with full Google Play Services"></a></center>

Click the graphic above to interact with it.

Using the graphical representation of the method count for all packages in your app, it becomes really easy to find which libraries are consuming your precious method count. Some of the usual suspects are big monolithic libraries like [Guava](https://github.com/google/guava) and the non-split-up [Google play services](https://developers.google.com/android/guides/overview#the_google_play_services_client_library). In the next section will see what we can do about these.

<br>

## Reducing method count

### Choosing the right libraries
Normally I recommend never to optimize unless you have a problem. But with method counts, I really advice you to consider the method count before you start using a library for two reasons:

1. Replacing libraries in existing apps can be very challenging, if not almost impossible.
2. Many developers are using huge libraries just to do simple things. (`Strings.isNullOrEmpty()` anyone?) Note that you don't need to use a library for everything!

Fortunately there is a great website [methodscount.com](http://www.methodscount.com/) that tells you the method count of a library before you start using it. This can really be helpful to avoid using "large libraries" which only add limited benefit to your app.

### Replacing existing libraries
Often there are multiple libraries accomplishing the same goals. Take for instance image loading:

| Library | Method count|
|---------|-------------|
| Picasso 2.5.2| 849 |
| Universal Image Loader 1.9.5| 1206 |
| Glide 3.7.0| 2879 |
| Fresco 0.9.0| 12984 |

Each of these libraries have their own benefits and features, so choose wisely and balance the features you are going to use versus the method count impact it will have.

That being said, replacing libraries in existing projects can be incredibly hard and may not even be feasible on the short term. Later I'll suggest an alternative solution to reduce method count in existing libraries.

### Running Proguard
Proguard is a great tool to strip out unused code from your app, but you typically only run it for release builds to save precious build time. If that's not really an issue for you, by all means you can also enable Proguard for debug builds:

```groovy
buildTypes {
    debug {
        minifyEnabled true
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
}
```

### Reducing library size
If it's not feasible to replace an existing library or to run Proguard all the time, then it becomes really interesting. Because if Proguard can strip out code during a release build, why not use it ahead of time to create a modified version of a library with fewer methods?

Well this is possible, but you'll have to manually specify which parts of the library you are going to use! This is because Proguard doesn't have a context during library stripping of what methods your application will be needing and what not.

Let's reproduce one of the projects I recently started working on as an example. Guava was used throughout the app extensively, making it very hard/risky to remove. But because of the huge method count we were constantly flirting with the 65k method limit and had to enable multidex.

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/dexcount-guava/debugChart/index.html"><img src="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_graphic_guava.gif" alt="Method count graphical output of sample project with Guava"></a></center>

First of all you need to know what parts of the library the app was actually using. This can easily be done by running the following command in your `src` folder.

```bash
grep -roh . -e 'com.google.common.*' | sort | uniq
```

This simply looks for all import statements starting with the library prefix (for Guava that is `com.google.common`), removes all clutter from the grep output, sorts it and takes all unique references.

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/grep_output.png"><img src="{{ site.blogbaseurl }}img/blog/methodcount/grep_output.png" alt="Grep output for references to Guava in an existing project"></a></center>

Next we'll create a simple Proguard configuration that keeps all top level packages, without any obfuscation or optimizations.

```java
-dontoptimize
-dontobfuscate

-keep public class com.google.common.base.** {
    public *;
}

-keep public class com.google.common.collect.** {
    public *;
}

-keep public class com.google.common.primitives.** {
    public *;
}

-keep public class com.google.common.util.** {
    public *;
}
```

Now we'll use a little Gradle script that takes a library as an input, runs Proguard on it an creates a new library as an output. If you're interested I advice you look at the [source code](https://github.com/JeroenMols/MethodCountExample/blob/master/shrink_lib/build.gradle), which is based on a script by [@mr_ligi](https://github.com/ligi/shrinkGuava). This Gradle script outputs a shrinked library version, which can be copied to the libs folder of your project.

Looking at our example, this simple process saved us 4000 methods and we are only just above the dex method limit.

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/dexcount-packageshrink/debugChart/index.html"><img src="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_graphic_packageshrink.gif" alt="Method count graphical output of sample project with stripped out Guava"></a></center>

Back to the drawing board, because this isn't nearly enough! Turns out the `collect` package by itself has over 8000 methods, so I decided to just keep certain classes instead of the entire package.

This more aggressive approach will most likely cause some compile errors when you try to use the library in your app, so I had to iterate and add some extra classes until all of those were solved. The resulting Proguard configuration looks like this:

```Java
-dontoptimize
-dontobfuscate

-keep public class com.google.common.base.** {
    public *;
}

-keep public class com.google.common.collect.Sets
-keepclassmembers class com.google.common.collect.Sets** {
 *;
 }

 -keep public class com.google.common.collect.Collections2
 -keepclassmembers class com.google.common.collect.Collections2** {
  *;
  }

-keep public final class com.google.common.collect.Lists
-keepclassmembers class com.google.common.collect.Lists** {
 *;
 }

-keep public final class com.google.common.collect.Iterables
-keepclassmembers class com.google.common.collect.Iterables** {
 *;
 }

-keep public class com.google.common.collect.ImmutableList.** {
    public *;
}

-keep public class com.google.common.io.CharStreams {
    public *;
}

-keep public class com.google.common.collect.HashMultiset
-keepclassmembers class com.google.common.collect.HashMultiset** {
 *;
 }

-keep public class com.google.common.collect.HashBiMap
-keepclassmembers class com.google.common.collect.HashBiMap** {
 *;
 }

-keep public class javax.annotation.Nullable.** {
     public *;
 }

-keep public class com.google.common.util.** {
    public *;
}

-keep public class com.google.common.primitives.** {
    public *;
}
```

Resulting in an extra decrease of almost 4500 methods, which brings the total removed methods to 8500!

<center><a href="{{ site.blogbaseurl }}img/blog/methodcount/dexcount-agressiveshrink/debugChart/index.html"><img src="{{ site.blogbaseurl }}img/blog/methodcount/methodcount_graphic_agressiveshrink.gif" alt="Method count graphical output of sample project with aggressively stripped out Guava"></a></center>

Further our build times have not only improved because we no longer need multidexing, but also because the compiler now has less code to process.

Obviously your mileage will vary depending on what library you choose. For low coupled, highly cohesive libraries (like Guava), this technique works really well, but for other libraries it might not.

> **Disclaimer**

> The technique presented above should be used with caution! Because instead of relying on Proguard to strip out what's not needed, we're now doing that manually, which is more error prone.

<br>

## Wrap-up
Hitting the 65k method limit is a real pain, but choosing wisely what libraries you use can already bring you a long way. Fortunately there are great tools like the [Dexcount Gradle Plugin](https://github.com/KeepSafe/dexcount-gradle-plugin) and [methodscount.com](http://www.methodscount.com/) to help with these decisions.

For existing projects, always try to replace existing large method libraries with alternatives. If this is not feasible and you feel comfortably using Proguard, you can use the latter to preprocess and shrink existing libraries.

A basic example project with everything in this blogpost integrated is available on [GitHub](https://github.com/JeroenMols/MethodCountExample).

As always you can reach me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leave a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Droidcon Italy recap</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/droidconit16/droidconit.png" class="img-responsive img-centered" alt="">
                            <p>A conference about our favorite Green little robots? In sunny Italy? With great food and a party? Yeah, I can image how you must feel in case you missed it... I on the other hand was fortunate enough to attend and speak at this awesome conference.

With over 770 attendees and four different tracks, it was obviously not possible to attend every session. But I did notice some general themes and would like to share my personal highlights with you.

<br>

## We are all UX
<center><a href="{{ site.blogbaseurl }}img/blog/droidconit16/wereallux.jpg"><img style="width: 50%" src="{{ site.blogbaseurl }}img/blog/droidconit16/wereallux.jpg" alt="We are all UX"></a></center>

The holy grail in app development is to have an amazing user experience. While app performance and feature set are obviously important, you must also understand your users, simplify main use cases and have a delightful design.

Do you really think a developer or designer alone can create such a great UX? NO, off course not! They'll both have to work together and synergize to really blow the users of their feet. We need more pairing between developers and designers folks!

The best advice I got was:

- A prototype is worth a thousand meetings.
- Five people to test your prototype with is the sweet spot. It's enough to notice patterns, yet not too much to be a burden.
- Developers and designers should be transparent and open to learn from each other
- "How might we..." is a great way to phrase problems as opportunities

<br>

## Optimizing layouts
<center><a href="{{ site.blogbaseurl }}img/blog/droidconit16/leanlayouts.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconit16/leanlayouts.jpg" alt="Loving lean layouts"></a></center>

Screens containing a lot of views can sometimes render slowly. Mostly caused by deeply nested view hierarchies and/or using RelativeLayouts as a root element. Using "heavy" layouts in lists or increased nesting makes these problems multiplicative instead of simply additive.

When running into issues, first resolve to Lint and investigate all warnings. If the problem persist, Hierarchy viewer will help you understanding what's going on. Always prefer simple solutions over complex ones and if you really really have to you can go - Facebook Style - replacing views with drawables.

The best advice in this track was:

- Rendering times in Hierarchy Viewer are not reliable
- Optimize responsibly

<br>

## DEX diet
<center><a href="{{ site.blogbaseurl }}img/blog/droidconit16/classyshark.png"><img src="{{ site.blogbaseurl }}img/blog/droidconit16/classyshark.png" alt="ClassyShark"></a></center>

Hitting the DEX method limit or trying to improve your app security? As a real Proguard expert you created an amazing configuration and now all those problems are gone. Or are they?

Analyzing your own APK file is a must to verify what methods are actually stripped and what code is obfuscated. Who knows you might even find some duplicate dependencies (GSON anyone?), causing a further method count reduction. Thanksfully all of this has become a breeze thanks to tools like [ClassyShark](http://www.classyshark.com/).

The best advice here was:

- Be restrictive using Proguard iso keeping entire packages
- IDE method count != dex method count
- Use [methodscount.com](http://www.methodscount.com/) to see how large a lib is before using it

<br>

## Other hot topics
<center><a href="{{ site.blogbaseurl }}img/blog/droidconit16/android_cookie.jpg"><img style="width: 50%" src="{{ site.blogbaseurl }}img/blog/droidconit16/android_cookie.jpg" alt="Android cookies"></a></center>

Besides the three main themes, other topics varied from Kotlin, over library distribution to (MVP) architecture and app store optimizations. Awesome sources of inspiration, brought by even more awesome speakers.

My key takeaways:

- Use App invites to grow your user base
- If you don't like testing your code, most likely customers won't like testing your app either
- Italian food is awesome

<br>

## Conference slides

- [Distribute your libraries via Maven, even privately](https://speakerdeck.com/jeroenmols/distribute-your-libraries-via-maven-even-privately) by Jeroen Mols
- [Think like a designer](https://photos.google.com/share/AF1QipMB_VOceGeOuQZ0UhBf0dKrGhgu92k8-qpXu0X5WtWUvoSqFJKRsoPzESyuhNEDRw?key=VVctWHBsVG4zZVlsRlBjVGRBWkIzT295Vk9qcWlB) by Nick Butcher
- [Let it flow](https://speakerdeck.com/dorvaryn/let-it-flow) by Benjamin Augustin
- [#Perfmatters for Android](https://speakerdeck.com/alosdev/perfmatters-for-android-droidcon-turin-2016) by Hasan Hosgel
- [Android Library A-Z](https://docs.google.com/presentation/d/1f05lCKSnCuzn9nJUMHN0nZ_buIVtsVnB_lrT4FR3wXo/edit#slide=id.p) by Martin Liersch
- [The bytecode mumbo-jumbo](http://blog.rafols.org/wp-content/uploads/2016_04_droidcon_it.pdf) by Raimon Ràfols
- [To ∞ (~65K) and beyond!](https://speakerdeck.com/dextor/to-65k-and-beyond) by Sebastiano Gottardo
- [Android data binding in action using MVVM pattern](http://www.slideshare.net/fabio_collini/data-binding-in-action-using-mvvm-pattern) by Fabio Collini
- [From Clockwork to smartwatch](https://speakerdeck.com/danybony/from-clockwork-to-smartwatch) by Daniele Bonaldo
- [Android internal library management](http://www.slideshare.net/KellyShuster/internal-android-library-management-droidcon-sf-2016) by Kelly Shuster
- [Reverse engineering is not just for hackers](https://speakerdeck.com/jonreeve/reverse-engineering-is-not-just-for-hackers) by Jon Reeve
- [How to talk to your users](https://speakerdeck.com/anothem/how-to-talk-to-your-users) by Alex Florescu
- [Crafting Great Hypotheses](http://www.slideshare.net/Aetheros/crafting-great-hypotheses-droidcon-2016) by Hoang Huynh
- [Building maintainable app with MVP and Dagger2](http://www.slideshare.net/KristijanJurkovi/building-maintainable-app) by Kristijan Jurković
- [Build An Efficient REST Client On Android](http://www.slideshare.net/duckma/build-an-efficient-rest-client-on-android-droidcon-it-2016-matteo-gazzurelli?ref=http://blog.duckma.com/2016/04/build-efficient-rest-client-on-android.html) by Matteo Gazzurelli
- [Chronicles of TDD](https://docs.google.com/presentation/d/1DK_kOp--XXdV_BYOYWw-wWPvJ1B_i4NIclDqWQqBSw8/edit#slide=id.p) by Luca Falsina
- [Backend 4 Android developers](https://backend4android.github.io/#/) by
Antonio Mallia & Nicola Corti
- [A realtime infrastructure for Android apps: Firebase may be what you need..and even more!](http://www.slideshare.net/AlessandroMartellucc/a-realtime-infrastructure-for-android-apps-firebase-may-be-what-you-needand-even-more) by
Alessandro Martellucci
- [Evolving the Android core with Aspects](http://www.slideshare.net/CarloPescio/evolving-the-android-core-with-aspects) by Carlo Pescio
- [Android: It's time to go to work!](https://speakerdeck.com/nibble/android-its-time-to-go-to-work) by Pietro Maggi
- [Drive together not the same](https://speakerdeck.com/joaobiriba/drive-together-not-the-same) by Giovanni Laquidara
- [A friend in need - A JS indeed](http://www.slideshare.net/yoni1984/a-friend-in-need-a-js-indeed) by Yonatan Levin
- [Application Architecture for Scaled Agile](https://speakerdeck.com/sangsoonam/application-architecture-for-scaled-agile-droidconit-2016) by Sangsoo Nam
- [FLUX based clean architecure](https://speakerdeck.com/unsign3d/flux-based-clean-architecure) by Luca Bruzzone
- [Engage and retain users in android world](http://www.slideshare.net/MatteoBonifazi/engage-and-retain-users-in-the-android-world-droidcon-italy-2016?from_m_app=android) by Matteo Bonifazi
- [Bonjour Android, it's Zeroconf](https://speakerdeck.com/tiwiz/bonjour-android-its-zeroconf) by Roberto Orgiu
- [We're all UX!](https://speakerdeck.com/lyslydia/were-all-ux) by Lydia Selimalhigazi and Caroline Smith
- [Mastering the NDK](http://www.slideshare.net/ph0b/mastering-the-ndk-with-android-studio-and-the-gradleexperimental-plugin) by Xavier Hallade
- [BLE beacons, Eddystone and Physical Web](https://www.blueupbeacons.com/docs/WorkshopBeacons.pdf) by Alessio Cucini and Samuele Forconi
- [World-Class Testing Development Pipeline for Android](http://www.slideshare.net/PedroVicenteGmezSnch/worldclass-testing-development-pipeline-for-android) by Pedro Vicente Gómez Sánchez]
- [ClassShark - Android and Java executables browser](http://www.slideshare.net/seamaster29/classshark-android-and-java-executables-browser) by Boris Farber

<br>

## Credits
Thanks to the entire Droidcon Italy team for organizing such a great conference and to all sponsers for their support.

<center><a href="{{ site.blogbaseurl }}img/blog/droidconit16/droidconit_team.jpg"><img src="{{ site.blogbaseurl }}img/blog/droidconit16/droidconit_team.jpg" alt="Droidcon Italy team"></a></center>
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>A successful XML naming convention</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/resourcenaming/resourcenaming.png" class="img-responsive img-centered" alt="">
                            <p>Do you remember the last time you had to dig into `strings.xml` to find the right String to use? Or that you manually had to go over all drawables to find the one you needed?

Whenever we start a new project, we take a lot of care in setting up our architecture, CI, build flavors,... But do you also have a strategy to name your resources?

You should! Because the lack of XML namespaces, makes managing Android resources tedious. And causes things to grow out of control easily, especially in large projects.

So let's introduce a simple scheme that will solve your pains.

- easy lookup of any resource (autocomplete)
- logical, predictable names
- clean ordering of resources
- strongly typed resources

This blogpost will explain the mechanism, its advantages, limitations and provide an easy to use cheat sheet.

<br>

## Basic principle
All resource names follow a simple convention.

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/whatwheredescriptionsize.jpg" alt="what_where_description_size">

Let's first describe every element briefly. After the advantages, we'll see how this applies to each resource type.

#### &lt;WHAT&gt;
Indicate what the resource actually represents, often a standard Android view class. Limited options per resource type. </br> (e.g. MainActivity -> `activity`)

#### &lt;WHERE&gt;
Describe where it logically belongs in the app. Resources used in multiple screens use `all`, all others use the custom part of the Android view subclass they are in. </br> (e.g. MainActivity -> `main`, ArticleDetailFragment -> `articledetail`)

#### &lt;DESCRIPTION&gt;
Differentiate multiple elements in one screen. </br> (e.g. `title`)

#### &lt;SIZE&gt; (optional)
Either a precise size or size bucket. Optionally used for drawables and dimensions. </br>  (e.g. `24dp`, `small`))

<center><a href="{{ site.blogbaseurl }}img/blog/resourcenaming/resourcenaming_cheatsheet.pdf"><img src="{{ site.blogbaseurl }}img/blog/resourcenaming/resourcenaming_cheatsheet.png" alt="Resource naming cheat sheet"></a></center>

Download and print the <a href="{{ site.blogbaseurl }}img/blog/resourcenaming/resourcenaming_cheatsheet.pdf">cheat sheet</a> for easy reference.
<br><br>

## Advantages

1. **Ordering of resources by screen** <br>
  The `WHERE` part describes what screen a resource belongs to. Hence it is easy to get all IDs, drawables, dimensions,... for a particular screen.
2. **Strongly typed resource IDs** <br>
  For resource IDs, the `WHAT` describes the class name of the xml element it belongs to. This makes is easy to what to cast your `findViewById()` calls to.
3. **Better resource organizing** <br>
  File browsers/project navigator usually sort files alphabetically. This means layouts and drawables are grouped by their `WHAT` (activity, fragment,..) and `WHERE` prefix respectively. A simple Android Studio plugin/feature can now display these resources as if they were in their own folder.
4. **More efficient autocomplete** <br>
  Because resource names are far more predictable, using the IDE's autocomplete becomes even easier. Usually entering the `WHAT` or `WHERE` is sufficient to narrow autocomplete down to a limited set of options.
5. **No more name conflicts** <br>
  Similar resources in different screens are either `all` or have a different `WHERE`. A fixed naming scheme avoids all naming collisions.
6. **Cleaner resource names** <br>
  Overall all resources will be named more logical, causing a cleaner Android project.
7. **Tools support** <br>
  This naming scheme could be easily supported by the Android Studio offering features such as: lint rules to enforce these names, refactoring support when you change a `WHAT` or `WHERE`, better resource visualisation in project view,...

<br>

## Layouts
Layouts are relatively simple, as there usually are only a few layouts per screen. Therefore the rule can be simplified to:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/layouts.png" alt="what_where.xml">

Where `<WHAT>` is one of the following:

| Prefix    | Usage                     |
| --------- | ----------------------    |
| activity  | contentview for activity  |
| fragment  | view for a fragment       |
| view      | inflated by a custom view |
| item      | layout used in list/recycler/gridview |
| layout   | layout reused using the include tag   |

Examples:

- **activity_main**: content view of the MainActivity
- **fragment_articledetail**: view for the ArticleDetailFragment
- **view_menu**: layout inflated by custom view class MenuView
- **item_article**: list item in ArticleRecyclerView
- **layout_actionbar_backbutton**: layout for an actionbar with a backbutton (too simple to be a customview)

<br>

## Strings
The `<WHAT>` part for Strings is irrelevant. So either we use `<WHERE>` to indicate where the string will be used:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/strings.png" alt="where_description.xml">

or `all` if the string is reused throughout the app:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/strings2.png" alt="all_description.xml">

Examples:

- **articledetail_title**: title of ArticleDetailFragment
- **feedback_explanation**: feedback explanation in FeedbackFragment
- **feedback_namehint**: hint of name field in FeedbackFragment
- **all_done**: generic "done" string

`<WHERE>` obviously is the same for all resources in the same view.

<br>

## Drawables
The `<WHAT>` part for Drawables is irrelevant. So either we use `<WHERE>` to indicate where the drawable will be used:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/drawables.png" alt="where_description_size.xml">

or `all` if the drawable is reused throughout the app:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/drawables2.png" alt="all_description_size.xml">

Optionally you can add a `<SIZE>` argument, which can be an actual size "24dp" or a size qualifier "small".

Examples:

- **articledetail_placeholder**: placeholder in ArticleDetailFragment
- **all_infoicon**: generic info icon
- **all_infoicon_large**: large version of generic info icon
- **all_infoicon_24dp**: 24dp version of generic info icon

<br>

## IDs
For IDs, `<WHAT>` is the class name of the xml element it belongs to. Next is the screen the ID is in, followed by an optional description to distinguish similar elements in one screen.

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/ids.png" alt="what_where_description.xml">

Examples:

- **tablayout_main** -> TabLayout in MainActivity
- **imageview_menu_profile** -> profile image in custom MenuView
- **textview_articledetail_title** -> title TextView in ArticleDetailFragment

<br>

## Dimensions
Apps should only define a limited set of dimensions, which are constantly reused. This makes most dimensions `all` by default.

Therefore you should mostly use:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/dimensions2.png" alt="what_all_description_size.xml">

and optionally use the screen specific variant:

<img src="{{ site.blogbaseurl }}img/blog/resourcenaming/dimensions.png" alt="what_where_description_size.xml">

Where `<WHAT>` is one of the following:

| Prefix    | Usage                     |
| --------- | ----------------------    |
| width     | width in dp               |
| height    | height in dp              |
| size      | if width == height        |
| margin    | margin in dp              |
| padding   | padding in dp             |
| elevation | elevation in dp             |
| keyline   | absolute keyline measured from view edge in dp |
| textsize  | size of text in sp        |

Note that this list only contains the most used `<WHAT>`s. Other dimensions qualifiers like: rotation, scale,... are usually only used in drawables and as such less reused.

Examples:

- **height_toolbar**: height of all toolbars
- **keyline_listtext**: listitem text is aligned at this keyline
- **textsize_medium**: medium size of all text
- **size_menu_icon**: size of icons in menu
- **height_menu_profileimage**: height of profile image in menu

<br>

## Known limitations
1. **Screens need to have unique names**<br>
To avoid collisions in the `<WHERE>` argument, View (like) classes must have unique names. Therefore you cannot have a "MainActivity" and a "MainFragment", because the "Main" prefix would no longer uniquely identify one `<WHERE>`.

2. **Refactoring not supported**<br>
Changing class names does not change along resource names when refactoring. So if you rename "MainActivity" to "ContentActivity", the layout "activity_main" won't be renamed to "activity_content". Hopefully Android Studio will one day add support for this.

3. **Not all resource types supported**<br>
The proposed scheme currently does not yet support all resource types. For some resources this is because they are less frequently used and tend to be very varied (e.g. raw and assets). For other resources this is because they are a lot harder to generalize (e.g. themes/styles/colors/animations).

    Your apps colors palette likely wants to reuse the terminology of your design philosophy. Animations can range from modest (fade) to very exotic. Themes and styles already have a naming scheme that allows you to implicitly inherit properties.

<br>

## Wrap-up
That's it! A clean simple and easy to use resource naming scheme. Don't forget to download the <a href="{{ site.blogbaseurl }}img/blog/resourcenaming/resourcenaming_cheatsheet.pdf">cheat sheet</a> for easy reference!

Even though this scheme doesn't (yet) cover all resource types, it does provide an easy to use solution for where most naming pain currently is. In a future blogpost I'll also make a suggestion for the other ones.

Let me know what you think by contacting me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leaving a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Git as a secure private Maven repository</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/wagongit/wagongit.png" class="img-responsive img-centered" alt="">
                            <p>As my previous blogposts already covered how to set up a private Maven repository, you might wonder "Why again a Maven blogpost?". Well that's a fair question and the answer is twofold:

1. Backup mechanism, to ensure you never ever loose releases.
2. Remote access outside of your local network (intranet).

And Git implicitly solves both! :)

I'll demonstrate how to configure Bitbucket as a free private remote Maven repository and automate everything in one simple Gradle script.

## Preface
While you could use any Git repository (like GitHub), I choose Bitbucket as it offers [free private repositories](https://bitbucket.org/product/pricing) for small teams. Furthermore it has an API which we will need for some of the wizardry later on.

All source code is available on [Github](https://github.com/JeroenMols/WagonGitExample) and can be used after some minor BitBucket configuration. You can find the [Gradle script](https://github.com/JeroenMols/GitAsMaven) in a separate repository.

## Bitbucket
Without any further a do, lets get to it and start configuring BitBucket.

Login to Bitbucket and create a new private repository called `maven_repository`.

<center><a href="{{ site.blogbaseurl }}img/blog/wagongit/createrepository.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/createrepository.png" alt="Create new BitBucket repository"></a></center>

Checkout the repository locally, create a `README.md` file and commit that file to your local branch. Now push that branch to BitBucket, BUT make sure to push it to a remote branch called "releases". (this is key, as the plugin we'll use later on depends on this)

<center><a href="{{ site.blogbaseurl }}img/blog/wagongit/releasebranch.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/releasebranch.png" alt="BitBucket repository with main branch releases."></a></center>

> **Troubleshooting releases branch**
> If you accidentally push your local branch to a remote called `master`, create a new branch locally called releases, push that to a remote `releases` and change your main branch in the BitBucket settings for that repository.
>
> <center><a href="{{ site.blogbaseurl }}img/blog/wagongit/configuremainbranch.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/configuremainbranch.png" alt="Change the main branch from master to releases"></a></center>
>
> You can safely remove origin/master if you want.

## Wagon-git
To upload Maven artifacts to a Git repository, we will use a Maven plugin called [Wagon-git](https://synergian.github.io/wagon-git/), which can hook into the existing Gradle DSL for Maven uploads.

Simply add a new repository:

```groovy
repositories {
    maven { url "https://raw.github.com/synergian/wagon-git/releases" }
}
```

And configure Maven like you would normally do, but with our BitBucket repository url in a particular format:

```groovy
uploadArchives {
    repositories.mavenDeployer {
        ...
        repository(url: 'git:releases://git@bitbucket.org:' + COMPANY + '/' + REPOSITORY_NAME + '.git')
        ...
    }
}
```

Where `COMPANY` is the name of your BitBucket organization and `REPOSITORY_NAME` is `maven_repository`.

Now you can simply create a new release by running the following command:

```bash
./gradlew assembleRelease uploadArchives
```

And check BitBucket for the resulting artifacts.

<center><a href="{{ site.blogbaseurl }}img/blog/wagongit/releasecommits.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/releasecommits.png" alt="Release commit of a Maven upload to BitBucket."></a></center>

<center><a href="{{ site.blogbaseurl }}img/blog/wagongit/releasecommitdetails.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/releasecommitdetails.png" alt="File details of a release commit."></a></center>

## Unique versions only
As Git naturally allows you to override existing files, we will need to do something to prevent this from happening. Otherwise, you could have a v1.1.3 library, which is stable one day and full of bugs the next (because someone replaced it in the Maven repo). Not exactly what you want, right?

We will use the BitBucket API to verify if a particular release already exists:

```groovy
task lookForArtifacts {
    doLast {
        ...
        def repositoryUrl = 'https://api.bitbucket.org/1.0/repositories/' + COMPANY + '/' + REPOSITORY_NAME + '/raw/releases/' + artifactPath
        ...
        if (urlExists(repositoryUrl)) {
            throw new RuntimeException("Artifact with version " + ARTIFACT_VERSION + " already exist - not executing uploadArchives")
        }
        return true
    }
}
```

Quite simple actually: just reverse engineer the url of a particular release artifact and the see if we get a 200 response or not.

Finally we ensure that we always run the previous task before running the Maven task:

```groovy
uploadArchives.dependsOn lookForArtifacts
```

Running `./gradlew uploadArchives` now successfully creates a release.

<center><a href="{{ site.blogbaseurl }}img/blog/wagongit/checkforartifacts.png"><img src="{{ site.blogbaseurl }}img/blog/wagongit/checkforartifacts.png" alt="Check for existing artifacts before uploadArchives."></a></center>

## Consuming artifacts
Add your Maven repository to the list of repositories in your main `build.gradle` file:

```groovy
allprojects {
    repositories {
        jcenter()

        maven {
            credentials {
                username USERNAME
                password PASSWORD
            }
            url "https://api.bitbucket.org/1.0/repositories/jeroenmols/maven_repository/raw/releases"
        }
    }
}
```

Note that we have to provide a `username` and `password` as we are connecting to a private repository.

> **Important**
>
> Make sure not to put your username and password directly into the `build.gradle` file! That would be a major security risk. Instead have a look at [this blogpost](http://localhost:4000/blog/2015/08/13/artifactory2/) to learn how to securely provide a username and password.

Now simply add a dependency on your library like you are used to and you're ready.

```groovy
dependencies {
    ...
    compile 'com.jeroenmols.awesomelibrary:awesomelibrary:1.0.0'
}
```

## Putting it all together
To make your life a lot easier, I've created a [Gradle script](https://github.com/JeroenMols/WagonGitExample/blob/master/library/publish-bitbucket.gradle) that does everything for you.

Setting up your project is easy:

1. Add the following plugin to the top of the [build.gradle](https://github.com/JeroenMols/WagonGitExample/blob/master/library/build.gradle) file in your library folder

  ```groovy
  apply from: 'https://raw.githubusercontent.com/JeroenMols/GitAsMaven/master/publish-bitbucket.gradle'
  ```

2. Create a [gradle.properties](https://github.com/JeroenMols/WagonGitExample/blob/master/library/gradle.properties) file within your library folder with the following parameters:

  ```groovy
  ARTIFACT_VERSION=<version_here>
  ARTIFACT_NAME=<libraryname_here>
  ARTIFACT_PACKAGE=<packagename_here>
  ARTIFACT_PACKAGING=aar //You could also use jar

  COMPANY=<bitbucket_team_company_here> //Username if not part of team
  REPOSITORY_NAME=<bitbucket_reponame_here>
  ```

3. Create a [gradle.properties](https://github.com/JeroenMols/WagonGitExample/blob/master/gradle.properties) file in the root of your project (or better in the global `.gradle` folder on your system) with the following parameters

  ```groovy
  USERNAME=<username_here>
  PASSWORD=<password_here>
  ```

4. Run the following command to upload a version to your Maven repository.

  ```bash
  ./gradlew uploadArchives
  ```

Thats's it!

## Wrap-up
Configuring BitBucket or GitHub as a (private) Maven repository is quite easy and can be fully automated in a single Gradle script. Hopefully this blogpost has inspired many of you to start reusing more code.

A basic example project with everything in this blogpost integrated is available on [GitHub](https://github.com/JeroenMols/WagonGitExample). Or you can also directly integrate the [Gradle script](https://github.com/JeroenMols/GitAsMaven) into your library.

As always you can reach me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leave a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Year in review 2015</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/yearinreview15/yearinreview15.png" class="img-responsive img-centered" alt="">
                            <p>Finally found the time to write my `year in review`. #insomnia

2015 was a huge year for me! I even dare to say the biggest one of my life so far as I became a father of a lovely daughter Lene. Its really hard to over state how big of an impact that has on your life and how fantastic it is to see your own baby grow (and recognize parts of yourself in her). This obviously also explains my late `year in review` post. #perfectexcuse

On a technical level I also fared well and I'm very happy with what I've been able to accomplish:

- Created an library with >500 stars on  [Github](https://github.com/JeroenMols/LandscapeVideoCamera)
- Started my own blog and [website](http://jeroenmols.com)
- Featured blogpost in [Android Weekly](http://androidweekly.net/issues/issue-165)
- Spoke at my first conference [Droidcon Paris](https://speakerdeck.com/jeroenmols/distributing-to-a-public-or-private-maven-repository)
- Actively started using [twitter](https://twitter.com/molsjeroen) and gained >100 followers
- Gained >1000 reputation on [stackoverflow](https://stackoverflow.com/users/2771851/jmols)
- Landed a new job at Philips Hue
- Learned Xamarin and built a cross platform app
- Wrote the worlds latest `year in review` post

Next year will be more challenging as my daughter has become a lot more effective at grabbing my attention than my laptop. However I want to increase my efforts contributing back to the community by speaking at more conferences and writing more blogposts. Finally I also want to visit Google IO, which is about time I got there, don't you agree? ;)

As always you can reach me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leave a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Level up GitHub builds with CI and code coverage</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/traviscoveralls/traviscoveralls.png" class="img-responsive img-centered" alt="">
                            <p>Wouldn't you love to have your open source projects built automatically by a continuous integration server? And to have a detailed code coverage report for all your unit tests? Even when someone generated a pull request? And how about having cool badges to show off all of this?

<center>[![Build Status](https://travis-ci.org/JeroenMols/LandscapeVideoCamera.svg?branch=master)](https://travis-ci.org/JeroenMols/LandscapeVideoCamera) [![Coverage Status](https://coveralls.io/repos/JeroenMols/LandscapeVideoCamera/badge.svg?branch=master&service=github)](https://coveralls.io/github/JeroenMols/LandscapeVideoCamera?branch=master)</center>

Actually, all of this a breeze to set up, once you understand what works and what doesn't. It is even completely free for open source projects!

In less than half an hour, this blogpost will add CI and code coverage to your projects, just like I did for my own library [LandscapeVideoCamera](https://github.com/JeroenMols/LandscapeVideoCamera). While this article focusses on Android, the material presented here can quite easily be extended to a broader scope.

## Preface
In order to keep things simple, I created a very basic project containing a [Calculator class](https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/src/main/java/com/jeroenmols/traviscoveralls/Calculator.java) and some [Android tests](https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/src/androidTest/java/com/jeroenmols/traviscoveralls/CalculatorTest.java). This will make things easier to understand as we'll add everything step by step to this project.

Later on I will present a more elaborate (and usefull) example, namely my own open source library [LandscapeVideoCamera](https://github.com/JeroenMols/LandscapeVideoCamera). Some time ago, I test driven refactored this project completely resulting in respectable code coverage statistics.

## Travis
### About
[Travis](https://travis-ci.org/) is a feature rich online CI service which integrates nicely with a lot of existing services. One major advantage over Jenkins is that you can put the entire CI configuration file under version control. It is completely free for open source projects, although private repositories are also supported on a subscription basis.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-workflow.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-workflow.png" alt="Travis workflow"></a></center>

### Basic configuration
In order to get started, go to [travis-ci.org](https://travis-ci.org/), login with your GitHub account and authorize Travis to access your repositories.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-authorize.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-authorize.png" alt="Allow Travis to access your GitHub projects"></a></center>

Next, create a new file `.travis.yml` into the root of your project (note that this file will be hidden on Mac OSX/Linux systems). Open the file and specify the language of your project, in our case Android:

```yaml
language: android
```

Now Travis needs to know all dependencies in order to build the project. As such specify the build tools version and compile Android SDK version (note that this must match the `compileSdkVersion` of your [`build.gradle`](https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/build.gradle) file!). While there is an option to use the latest build tools version, I recommend to declare an explicit version as this makes your builds more reproducible. Next specify all of the Android SDK manager dependencies your project needs so Travis can install them before building the project.

```yaml
android:
  components:
    - build-tools-22.0.1
    - android-23
    - extra-android-m2repository
```

Note that our sample only depends on the AppCompat and design support library, hence there is only one extra defined `extra-android-m2repository`. In case your project uses other dependencies from the Android SDK, you can easily select them from the entire [dependency list](https://github.com/JeroenMols/TravisCoverallsExample/blob/master/misc/android_sdk_dependencies.txt) and add an extra item.

> **Extra: listing Android SDK dependencies**
>
> To generate the above mentioned list of Android SDK components, simply run the following command on your local machine:
>
>```bash
>android list sdk --no-ui --all --extended
>```

After, specify the exact `Gradle` command to run, in our case `assembleDebug`:

```yaml
script:
    - ./gradlew assembleDebug
```

Now that we have configured everything in the `travis.yml` file, we need to enable the project, so Travis will start listening to code changes. This can be done by going to your profile on [Travis](http://travis-ci.org) and flipping the appropriate slider.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-enableproject.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-enableproject.png" alt="Enable project in Travis"></a></center>

This will result in the project being shown on the left hand side of your dashboard, while indicating that there are no builds.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-nobuilds.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-nobuilds.png" alt="Travis overview with no builds, push code to origin to trigger a build."></a></center>

Builds are automatically triggered whenever you push code to your GitHub repository or someone else creates a pull request. Therefore push some changes to GitHub and watch Travis pick them up automatically and start building your project.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-firstbuild.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/travis-firstbuild.png" alt="First build in Travis"></a></center>

Congrats! You now have a fully working Continuous Integration server for your [open source project](https://travis-ci.org/JeroenMols/TravisCoverallsExample).

### Running Android unit tests
While running normal unit tests is straight forward, Android tests are a different story because they require an Android emulator to run on. And because Travis support for Android is still in [beta](http://docs.travis-ci.com/user/languages/android/), there are a couple of limitations to consider:

1. Only `armeabi-v7a` emulators are supported.
2. The Android M emulator is not yet supported.

> **Extra limitations of Travis Android support**
>
> You can *skip this if you want*, just some extra context
>
> First of all, Travis does not yet support HAXM to speed up intel emulators, so there is no speed up while using an `x86` emulator. Even more, the latest `x86_64 Android M` emulator requires hardware acceleration, so that one simply cannot be used on Travis! For more information see issue [1419](https://github.com/travis-ci/travis-ci/issues/1419) and [1395](https://github.com/travis-ci/travis-ci/issues/1395) or check out this [failing build](https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88619658#L693).
>
> Secondly, Travis does not yet support the latest Android M emulator, causing the built-in `android-wait-for-emulator` script to time out while the emulator is booting. Therefore I recommend to use the `android-22` emulator instead. For more information see this [failing build](https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88620580#L1069).

So you'll have to accept that builds will be slow (starting emulator + running test) and that you cannot use an Android M emulator. But if these are acceptable, read on and I'll explain how to set up everything for running tests.

First of all, define the Android version and processor architecture of the emulator by adding a new environment at the top of the `travis.yml` file:

```yaml
env:
  matrix:
    - ANDROID_TARGET=android-22 ANDROID_ABI=armeabi-v7a
```

Then, ensure that all dependencies for the Android emulator are installed, by adding both the platform version and emulator image to the `components` section. Note that it is important to add both, because the Android emulator will only install if the corresponding Android platform is installed (see this [failing build](https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88631850#L815)).

```yaml
android:
  components:
    ...
    - android-22
    - sys-img-armeabi-v7a-android-22
```

Now we need to create a new Android emulator and start it before our build. As starting takes a really long time, Travis offers a built-in `android-wait-for-emulator` script to facilitate this. Finally we need to unlock the emulator once started by sending a key event.

```yaml
before_script:
    - echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI
    - emulator -avd test -no-skin -no-audio -no-window &
    - android-wait-for-emulator
    - adb shell input keyevent 82 &
```

After all of this configuration, all we need to do is change the `Gradle` command to run all of the tests and trigger a new build by pushing all these changes.

```yaml
script:
    - ./gradlew connectedAndroidTest
```

### Taking things further
As mentioned in the introduction, Travis is a really feature rich CI service. Therefore this section provides some tips to take things even further.

1. **Build notifications:** Travis supports sending notifications via Slack, HipChat, email,... whenever a built fails/succeeds.</p>
For more information, have a look at the [Travis documentation](http://docs.travis-ci.com/user/notifications/).

```yaml
notifications:
    email:
      - your.email@gmail.com
```

- **Build status badge:** Click the build badge on your Travis homepage to generate png/markdown/... build badges.</p>
[![Build Status](https://travis-ci.org/JeroenMols/TravisCoverallsExample.svg?branch=master)](https://travis-ci.org/JeroenMols/TravisCoverallsExample)

- **Branch information:** Print which branch or pull request is being built.

```yaml
script:
    - echo "Travis branch is $TRAVIS_BRANCH"
    - echo "Travis branch is in pull request $TRAVIS_PULL+REQUEST"
```

- **More options:** Have a look at the [Travis documentation](http://docs.travis-ci.com/user/languages/android/).

## Coveralls
### About
[Coveralls](https://coveralls.io/) is a visually attractive online code coverage tool which provides detailed statistics such as line coverage and repository trends. Furthermore it allows you to show of your code coverage and encourages you to increase it. Like Travis, it is free for open source projects, but a subscription service is available for private repositories.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-example.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-example.png" alt="Example coveralls dashboard"></a></center>

### Enabling Android code coverage
First of all, your Android project needs to be configured to generate code coverage reports. As such, ensure that you are using at least version 0.4 of the [Android testing support library](https://google.github.io/android-testing-support-library/) (there was an [issue](https://code.google.com/p/android/issues/detail?id=170607) in version 0.3).

Then add the flag `testCoverageEnabled` to the debug buildTypes in your main module's `build.gradle` file, causing a code coverage report to be generated in the `build/reports/coverage/` folder.

```groovy
android {
  ...

  buildTypes {
        debug {
            testCoverageEnabled true
        }
    }
}
```

At this point, you should be able to run `gradle connectedAndroidTest` and view an `html` and `xml` report in the above mentioned directory.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-rawcoverage.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-rawcoverage.png" alt="Basic coverage report generated by the built in Android code coverage"></a></center>

### Basic configuration
In order to get started, go to [coveralls.io](https://coveralls.io/), login with your GitHub account and authorize Coveralls to access your repositories.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-authorize.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-authorize.png" alt="Allow Coveralls to access your GitHub projects"></a></center>

Next, we'll need to configure your `build.gradle` files to upload the coverage reports to Coveralls after each successful CI build. Therefore add a new classpath dependency to the root projects `build.gradle` file.

```groovy
buildscript {
    ...

    dependencies {
        ...
        classpath 'org.kt3k.gradle.plugin:coveralls-gradle-plugin:2.4.0'
    }
}
```

Then we can apply the `coveralls` plugin, point it to the coverage reports directory and ensure it only runs on CI builds by adding the following to your main module's `build.gradle` file:

```groovy
apply plugin: 'com.github.kt3k.coveralls'
```

```groovy
coveralls {
    jacocoReportPath = "${buildDir}/reports/coverage/debug/report.xml"
}

tasks.coveralls {
    dependsOn 'connectedAndroidTest'
    onlyIf { System.env.'CI' }
}
```

Note that we also added a dependency on the `connectedAndroidTest` task as that is the one that will actually generate the code coverage report.

Let's now change the build task in the `travis.yml` so it runs the `coveralls` task after every build. While not strictly necessary to still define the `connectedAndroidTest` task, I prefer to do so as it makes it more explicit what `Gradle` will exactly be building.

```yaml
script:
  ...
  - ./gradlew connectedAndroidTest coveralls

```

Next we need to activate our GitHub repository in coveralls, so it picks up the output from the `Gradle` plugin. This can easily be done by clicking `add repos` on [coveralls.io](https://coveralls.io) and flipping the switch on your repository.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-enableproject.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-enableproject.png" alt="Enable project in Coveralls"></a></center>

This will result in the project being added to your dashboard without any builds.

<center><a href="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-nobuilds.png"><img src="{{ site.blogbaseurl }}img/blog/traviscoveralls/coveralls-nobuilds.png" alt="No builds yet in Coveralls"></a></center>

Simply trigger a Travis build by pushing some changes to start seeing code coverage results online.

Finally you can easily add a badge to your repository by clicking the `Badge urls` button from the green banner in the detail view.

<center>[![Coverage Status](https://coveralls.io/repos/JeroenMols/TravisCoverallsExample/badge.svg?branch=master&service=github)](https://coveralls.io/github/JeroenMols/TravisCoverallsExample?branch=master)</center>

Congratulations you know have attractive code coverage reports for [your repository](https://coveralls.io/github/JeroenMols/TravisCoverallsExample)!

## Wrap-up
Adding Travis CI and Coveralls code coverage to your project is fairly straightforward once you know what works and especially what doesn't work. Hopefully this blogpost was able to remove a lot of those frustrating barriers of entry.

A basic example project with everything in this blogpost integrated is available on [GitHub](https://github.com/JeroenMols/TravisCoverallsExample). But in case you're interested in a real life example, have a look at my Android library [LandscapeVideoCamera](https://github.com/JeroenMols/LandscapeVideoCamera), which actually has decent code coverage statistics.

<center>[![Build Status](https://travis-ci.org/JeroenMols/LandscapeVideoCamera.svg?branch=master)](https://travis-ci.org/JeroenMols/LandscapeVideoCamera) [![Coverage Status](https://coveralls.io/repos/JeroenMols/LandscapeVideoCamera/badge.svg?branch=master&service=github)](https://coveralls.io/github/JeroenMols/LandscapeVideoCamera?branch=master)</center>

As always you can reach me [@molsjeroen](https://twitter.com/molsjeroen) on twitter, or leave a comment below!
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Getting the most out of Artifactory</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/artifactory2/artifactory2.png" class="img-responsive img-centered" alt="">
                            <p>My previous [blog post]({% post_url 2015-08-06-artifactory %}) described how to set up your own private Maven repository with Artifactory in 30 minutes. This second and final part will make things more interesting and take your setup to the next level.

You will learn how to:

- handle library projects with dependencies
- securely provide username and password
- work with snapshot and release builds
- configure custom repositories
- manage user access

All source code is [available on Github](https://github.com/JeroenMols/ArtifactoryExample) as usual.

Note that the material presented here can quite easily be extended to be applicable beyond Android.

## Library projects with dependencies
Imagine if your Android library project itself has dependencies. Then the application using the library wouldn't be able to run unless it provides all dependencies the library requires.

To better understand this, consider the new [`AwesomeAdvancedLibrary`](https://github.com/JeroenMols/ArtifactoryExample/blob/master/AwesomeAdvancedLibrary/awesomeadvancedlibrary/src/main/java/com/jeroenmols/awesomeadvancedlibrary/AwesomeConvertor.java) which makes use of [Guava](https://github.com/google/guava) to *awesomize* a `String`. The application using this library should be agnostic of this dependency. Hence we do not want to define two dependencies:

```groovy
dependencies {
    compile 'com.jeroenmols.awesomeadvancedlibrary:awesomeadvancedlibrary:1.0.0'
    compile 'com.google.guava:guava:18.0'
}
```


Instead one `compile` dependency should suffice to use the library.

> **Important note on including dependencies**
>
> You can *skip this if you want*, just some extra context
>
>Including dependencies in your library is not always a good idea, because this can lead to a dependency conflict while integrating. I only choose Guava to keep things simple, but it is actually a very bad example as it is a utility library. This means it's quite likely that the app also needs it.
>
> A better example would be a universal *analytics* library offering a universal API to track analytics and redirecting all calls internally to one or more analytics providers. Here packaging dependencies makes sense, because the app never needs to talk to the dependency directly. It also hides implementation details, so the app doesn't need to be modified when switching to a new provider.

Imagine if we would simply resort to the buildscript we had in my previous [blogpost]({% post_url 2015-08-06-artifactory %}). At compile time the `Guava` dependency will not be included, because the would make the library unnecessarily large. Instead, the compiler will tell the library: "don't worry about this dependency, the app will provide it for you."

The app on the other hand wouldn't have a clue which dependencies the library actually needs (how would it?) and hence the app will compile just fine. However, after starting the app and trying to access the library, the app would crash at runtime:

```Java
08-09 20:49:46.096  28892-28892/? E/AndroidRuntime﹕ FATAL EXCEPTION: main
Process: com.jeroenmols.awesomeadvancedapplication, PID: 28892
java.lang.NoClassDefFoundError: Failed resolution of: Lcom/google/common/base/CharMatcher;
    at com.jeroenmols.awesomeadvancedlibrary.AwesomeConvertor.toAwesome(AwesomeConvertor.java:11)
```

To solve this, we need to ensure that the library `pom.xml` file  contains the right dependencies by manually adding the `pom.withXml{}` element to the `publishing task`:

```groovy
publishing {
    publications {
        aar(MavenPublication) {
            groupId packageName
            version = libraryVersion
            artifactId project.getName()
            artifact("$buildDir/outputs/aar/${project.getName()}-release.aar")

            pom.withXml {
                def dependencies = asNode().appendNode('dependencies')
                configurations.getByName("_releaseCompile").getResolvedConfiguration().getFirstLevelModuleDependencies().each {
                    def dependency = dependencies.appendNode('dependency')
                    dependency.appendNode('groupId', it.moduleGroup)
                    dependency.appendNode('artifactId', it.moduleName)
                    dependency.appendNode('version', it.moduleVersion)
                }
            }
        }
    }
}
```

Note that while you can similarly add other repositories in this way to the `pom.xml`, Gradle itself [won't look](https://discuss.gradle.org/t/resolving-problem-when-maven-repo-contains-pom-but-not-jar/7174) for repositories in that file. Therefore if you use libraries from 3rd party repositories, you still need to add those repositories to the `build.gradle` of your app.

## Securely provide username and password
Obviously we do not want to store a plain text username and password in any file that we check in to our version control system. So to make sure we hide those, create a `gradle.properties` file in the root of your project and add the following content:

```groovy
artifactory_username=admin
artifactory_password=password
```

Then in your `build.gradle` file, refer to the properties like this:

```groovy
username = artifactory_username
password = artifactory_password
```

We have now obfuscated the password, so it is no longer in the `build.gradle` file, but people can still find it in the `gradle.properties` file under version control. To prevent this, you must do one of the following:

- Don't add `gradle.properties` to your version control system. (add it to your `.gitignore` file instead)
- Move the `gradle.properties` to the base `~/.gradle` folder on your hard drive. I personally recommend this approach as you can never accidentally check in your username and password.

## Working with Snapshot and Release builds
While the Artifactory Gradle plugin doesn't have support for snapshot/release builds out of the box, it is easy to add this functionality by relying on the artifact version:

- For release builds: use [symantic versioning](http://semver.org/) e.g. `1.0.0`
- For Snapshot builds: use symantic versioning with `-SNAPSHOT` suffix e.g. `1.0.0-SNAPSHOT`

Now you can direct each one to a different Artifactory repository by changing the repository key as follows:

```groovy
repoKey = libraryVersion.endsWith('SNAPSHOT') ? 'libs-snapshot-local' : 'libs-release-local'
 ```

On the application side you need to add two different Maven urls so you can refer to artifacts in both repositories.

```groovy
allprojects {
    repositories {
      maven { url "http://localhost:8081/artifactory/libs-release-local" }
      maven { url "http://localhost:8081/artifactory/libs-snapshot-local" }
    }
}
```

Referencing artifacts is exactly the same as before, just don't forget to add the `-SNAPSHOT` suffix for snapshot artifacts.

Alternatively we can also create a `virtual` repository in Artifactory which wraps around both repositories. This way the app only requires one URL, but does create a dependency on the existing Artifactory setup.

1. Login to Artifactory and go to admin > repositories > virtual
  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_virtualrepo1.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_virtualrepo1.png" alt="All virtual repositories can be found under admin - repositories - virtual"></a></center>
2. Create a new virtual maven repository which contains both `libs-release-local` and `libs-snapshot-local`
  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_virtualrepo2.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_virtualrepo2.png" alt="Create a new virtual maven repository which contains both libs-release-local and libs-snapshot-local"></a></center>
3. In the top level `build.gradle` of your application, replace the two previous URLS by the following:

  ```groovy
  allprojects {
      repositories {
        maven { url "http://localhost:8081/artifactory/libs-local" }
      }
  }
  ```

## User access management
Currently everyone can both read and write to all your repositories. This is not a good idea, especially if your server is also connected to the internet. Therefore we are going to set up two different users: one to deploy artifacts and one to consume artifacts.

In order to do so, go to artifactory and login as `admin`. Now navigate to admin > security > general and make the following changes:

- set `Allow Anonymous Access` to false -> ensures only known Artifactory users can consume artifacts
- set `Password Encryption Policy` to `REQUIRED` -> ensures we don't have to hardcode a plain text password in our `build.gradle`.
- press the `encrypt` button in the `Password Encyption` section -> encrypts all passwords

If the app now tries to consume an artifact, it will get a `401` error: unauthorized. You can verify this yourself by clearing the gradle cache (to force a dependency download):

```bash
gradle clean --refresh-dependencies
```

Next, go to the `Users` pane and add two new user: `consumer` and `deployer`. Make sure not to add them to any group.

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_user1.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_user1.png" alt="Settings for consumer user"></a></center>

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_user2.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_user2.png" alt="Settings for deployer user"></a></center>

Note that you probably also want to change your admin password at this stage. ;)

Now go to the `Permissions` pane and add a new `Consume Libraries` permission. Set the Selected repositories to include the snapshot and release repository, and in the `Users` tab add the `consumer` user with read permissions.

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission1.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission1.png" alt="Settings for Consume Libraries permission"></a></center>

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission2.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission2.png" alt="Settings for Consume Libraries permission"></a></center>

Add a second permission: `Deploy Libraries` with the snapshot and release repository included. Here give the `deployer` user `Deploy/Cache` permission but not `Delete/Overwrite` as you never want to override an existing artifact!

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission3.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission3.png" alt="Settings for Deploy Libraries permission"></a></center>

  <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission4.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_permission4.png" alt="Settings for Deploy Libraries permission"></a></center>

All we need to do now is modify the Library and Application to make use of these new users. This is easy for the Library as you can simply replace the `admin` user with the `deploy` user in the `gradle.properties` file.

For the Application we will need to provide credentials to access the Maven repository. Here we will hard code the username and password in the top level `build.gradle` file because team members should be able to checkout and build the code without extra configuration.

Therefore we will take some extra security precautions:

- Use a user with read access to only a small subset of our repositories: `deploy`.
- Check the code into a private repository, so the hardcoded password is protected by repository password.
- Use the encrypted version of the password instead of the plain text version:
  - Login to artifactory as the `consumer` user
  - Navigate to the user settings in the top right corner
  - Unlock your profile with your password
  - Copy the API key

    <center><a href="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_consumer.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory2/artifactory2_consumer.png" alt="Copy the API key from the consumer profile."></a></center>

Now add the user authentication to the top level `build.gradle` file:

```Groovy
allprojects {
    repositories {
        jcenter()
        // NOTE: configure your virtual repository and user in artifactory to make this work
        maven {
            url "http://localhost:8081/artifactory/libs-local"
            credentials {
                username 'consumer'
                password 'APA52uxnRkmxeRXmJqd7haMpwgg'
            }
        }
    }
}
```

And we are all set with authenticated access to our repositories.

## Wrap-up
That's a wrap to my two part blogpost about Artifactory! We made our previous repository a lot more secure, added support for dependencies and can now differentiate between release and snapshot artifacts.

No more excuses not to write reusable code!

Feel free to leave a comment and don't forget to check the [full source code](https://github.com/JeroenMols/ArtifactoryExample) on Github.
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>A private Maven repository for Android in 30 min</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/artifactory/artifactory.png" class="img-responsive img-centered" alt="">
                            <p>Setting up your own Maven repository and uploading artifacts to it is quite a daunting task. As I went through this experience myself recently, I want to help others in setting up their own Maven repository via [Artifactory](http://www.jfrog.com/open-source/) and automate uploading artifacts using Gradle.

In less than 30 minutes you will have a fully operational private Maven repository and have configured your Gradle buildscripts to upload your Android library artifacts.

Note that the material presented here can quite easily be extended to be applicable in a broader scope beyond Android.

## Setting up a Repository Manager
First of all we need to make sure we have an actual Maven repository to upload our artifacts to. According to [Maven](https://maven.apache.org/repository-management.html) you should use a repository manager to do that:

> **Best Practice - Using a Repository Manager**

> A repository manager is a dedicated server application designed to manage repositories of binary components. The usage of a repository manager is considered an essential best practice for any significant usage of Maven.

### Why Artifactory?

While there are some options available to choose from, I personally selected [Artifactory](http://www.jfrog.com/open-source/) because:

- Clear and attractive UI
- Super fast configuration
- Gradle plugin
- User access control
- Free and open source

<center>[![What is Artifactory](http://img.youtube.com/vi/aa4YBDUDWy0/0.jpg)](http://www.youtube.com/watch?v=aa4YBDUDWy0)</center></p>

For more information have a look at the [alternatives](https://maven.apache.org/repository-management.html), checkout this [feature comparison matrix](http://www.jfrog.com/blog/artifactory-vs-nexus-integration-matrix/) or review all of the [Artifactory features](https://www.jfrog.com/confluence/display/RTF/Artifactory+Comparison+Matrix).

### Verify you have Java SDK 8
Before you get started, make sure that you have Java SDK 8 installed, or otherwise Artifactory won't start. You can easily verify your Java version with `java -version`:

```bash
$ java -version
java version "1.8.0_51"
Java(TM) SE Runtime Environment (build 1.8.0_51-b16)
Java HotSpot(TM) 64-Bit Server VM (build 25.51-b03, mixed mode)
```

If it doesn't output at least version `1.8.x`, you should [download](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) and install a new Java SDK before you continue.

Note that the error you get if you don't have Java 8 looks a bit cryptic:

```
Aug 05, 2015 9:29:31 AM org.apache.catalina.core.StandardContext startInternal
SEVERE: One or more listeners failed to start. Full details will be found in the appropriate container log file
```

### Install Artifactory
Thankfully this is incredibly easy to do. Just download the latest version of [Artifactory](http://www.jfrog.com/open-source/), unpack the archive and run the `artifactory` executable for your platform.

<center>[![< 1min Artifactory set up](http://img.youtube.com/vi/7ZSUHgHDMmc/0.jpg)](http://www.youtube.com/watch?v=7ZSUHgHDMmc)</center></p>

You can easily verify your installation and start experimenting with its features by navigating to [http://localhost:8081/artifactory/](http://localhost:8081/artifactory/). For now, don't worry about all of the settings, we will configure what we need later on.

### Configuring Gradle to upload Android artifacts
Let's upload a very simple archive by configuring a new Gradle task for our Android library project.

In your top level `build.gradle` file, add a reference to the repository of the Artifactory Gradle plugin:

```groovy
buildscript {
    dependencies {
        classpath "org.jfrog.buildinfo:build-info-extractor-gradle:3.1.1"
    }
}
```

Next in your library we will need to apply two new plugins: one to prepare the Maven artifacts `maven-publish` and one to upload the archives to Artifactory ` com.jfrog.artifactory`:

```groovy
apply plugin: 'com.jfrog.artifactory'
apply plugin: 'maven-publish'
```

Every Maven artifact is identified by three different parameters:

- artifactId: the name of your library
- groupId: usually the package name of your library
- version: identifies different releases of the same artifact

For the last two, we will explicitly define a variable in the `build.gradle` file.

```groovy
def packageName = 'com.jeroenmols.awesomelibrary'
def libraryVersion = '1.0.0'
```

The `artifactId` however needs to match the output filename of the `assembleRelease` task. Therefore we either have to [rename the library module](https://stackoverflow.com/questions/26936812/renaming-modules-in-android-studio) or explicitly [specify the output filename](https://stackoverflow.com/questions/24728591/how-to-set-name-of-aar-output-from-gradle). I personally prefer the first approach, which allows to get `artifactId` in the following way:

```groovy
project.getName() // the ArtifactId
```

Now we need to configure the `maven-publish` plugin so that it knows which artifacts to publish to Artifactory. For our purpose we will refer to the `***-release.aar` file, generated by the `assembleRelease` task. Note that we can predict the name by taking the name of the Library project:

```groovy
publishing {
    publications {
        aar(MavenPublication) {
            groupId packageName
            version = libraryVersion
            artifactId project.getName()

            // Tell maven to prepare the generated "*.aar" file for publishing
            artifact("$buildDir/outputs/aar/${project.getName()}-release.aar")
      }
    }
}
```

Finally we need to configure the `com.jfrog.artifactory` plugin so it knows which repository to publish the artifacts to. For simplicity we will upload the artifact to the locally running Artifactory instance ([http://localhost:8081/artifactory](http://localhost:8081/artifactory)) and place it in the default `libs-release-local` repository. Note that the username `admin` and password `password` are hardcoded in this example, but we will provide a better solution for that later.

```groovy
artifactory {
    contextUrl = 'http://localhost:8081/artifactory'
    publish {
        repository {
            // The Artifactory repository key to publish to
            repoKey = 'libs-release-local'

            username = "admin"
            password = "password"
        }
        defaults {
            // Tell the Artifactory Plugin which artifacts should be published to Artifactory.
            publications('aar')
            publishArtifacts = true

            // Properties to be attached to the published artifacts.
            properties = ['qa.level': 'basic', 'dev.team': 'core']
            // Publish generated POM files to Artifactory (true by default)
            publishPom = true
        }
    }
}
```

### Deploying artifacts
Now that our Gradle buildscripts are properly configured we can easily publish artifacts to Artifactory by running the following command:

```groovy
gradle assembleRelease artifactoryPublish
```

Notice how we first invoke `assembleRelease` before we invoke the actual `artifactoryPublish` task, because of the way we defined the artifacts to publish in the previous section.

You can very easily verify that the upload was successful by navigating to [localhost:8081](http://localhost:8081) and signing in with the default admin credentials.

<center><a href="{{ site.blogbaseurl }}img/blog/artifactory/artifactory_screenshot.png"><img src="{{ site.blogbaseurl }}img/blog/artifactory/artifactory_screenshot.png" alt="Verify a successful upload in the Artifactory control panel."></a></center>

### Using the artifacts
To make use of the published artifacts in another project we have to add our Artifactory repository to the list of Maven repositories in your top level `build.gradle` file:

```groovy
allprojects {
    repositories {
        maven { url "http://localhost:8081/artifactory/libs-release-local" }
    }
}
```

After we can simply add the artifact as a dependency in the `build.gradle` file of our main project:

```groovy
dependencies {
    compile 'com.jeroenmols.awesomelibrary:1.0.0'
}
```

## Wrap-up
Congratulations! You now have a fully working Maven repository manager with a Gradle script to generate and upload your artifacts.

In the next [blog post]({% post_url 2015-08-13-artifactory2 %}) I will zoom in on more advanced topics like:

- Library projects with dependencies
- Configuring your own repositories
- User access management and rights
- Removing hardcoded username and password from `build.gradle`

I have also uploaded a [complete example](https://github.com/JeroenMols/ArtifactoryExample) on GitHub for your reference.
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-nieuwsblad" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Het nieuwsblad</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/Nieuwsblad_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.nieuwsblad.be/>Mediahuis</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>Juli 2015</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.twipemobile.nbmobile>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>How I created my blog</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/img/blog/jekyll.png" class="img-responsive img-centered" alt="">
                            <p>For quite some months, I've been planning to create a website and start blogging about the things I'm passionate about. Last week, I finally decided to setup a [portfolio](http://jeroenmols.github.io) and [blog](http://jeroen.mols.github.io/blog) using GitHub pages and Jekyll.

Since I'm an Android and not a web developer, the first blogging subject wasn't hard to find: challenges I came across in setting up this website and blog.

> **Disclaimer:** Eventually I had to use a workaround - that's why I don't build websites professionally - but I strongly believe in a *Just do It* mentality and then learn/improve as you go.

## Why Jekyll
Keeping it simple, I only had few requirements for my blog:

- Responsive website
- Easy to setup and maintain
- No lock-in: able to migrate to other platforms
- Support for pagination and comments

First thing I learned was the difference between a static (e.g. Jekyll) and dynamic website (e.g. Wordpress) via a [great presentation](http://nilclass.com/courses/what-is-a-static-website/) by [@plusjade](https://twitter.com/plusjade).

The main advantage of static websites is their loading speed because all pages are generated before they are served. Installing the generator on your local machine is simple, making it easy to test your site before deploying online. Posts are written in Markdown, so no HTML clutter nor extra tools needed. Just a text generator and Git to conveniently version all changes.

>**Protip:** One of my colleagues [@inferis](https://twitter.com/inferis) even gets spelling corrections via Pull request!

As GitHub pages natively supports Jekyll, I didn't really spent much time on choosing which [static site generator](https://staticsitegenerators.net/) to use.

## Setting up
Installing Jekyll was really a breeze, I just had to run `gem install Jekyll` and then I could build my website using `jekyll build` or test it locally using `jekyll serve`.

> **Note:** both commands will generate your website in the `_site` folder, which you shouldn't add to version control!

Instead of making a new Jekyll site, I decided to fork two existing themes:

- [Hyde](http://hyde.getpoole.com/): a clean two-column theme for my Blog
- [Freelancer](http://startbootstrap.com/template-overviews/freelancer/): to have a cool portfolio

Both themes offer quite some predefined customization options via the `_config.yml` file, but for advanced theming you can also directly edit the CSS files.

## Merging two Jekyll themes
Where I originally only wanted to have a blog, the Freelancer theme was just too cool to ignore. Consequently merging two themes was one of the first things I had to do.

It seemed most convenient to have my portfolio under my main url and to include my blog under a subfolder (i.e. `jeroenmols.github.io/blog`).

To do this I merged the blog theme into the portfolio (main) theme:

- Add a subfolder `blog/` with the `index.html` of my blog.

- Move all my portfolio posts and blog posts into separate folders:
	- all portfolio posts went into `portfolio/_posts`
	- all blog posts went into `blog/_posts`

	This allows to easily loop through all portfolio or blog posts separately:

	- `{{ "{% for post in site.categories.portfolio " }}%}`
	- `{{ "{% for post in site.categories.blog " }}%}`

- Move all files in `_layouts` and `_includes` from my blog into the corresponding folders of my portfolio theme.
	- Optionally you can move files into subfolders to keep things clean (`_includes/blog`), as long as you also update all references to these files. (in `_layouts/blog.html` I now refer to my includes as `blog/<original name>`)
	- Same holds true if you have naming conflicts (for instance two layouts with the same name), you can just rename one and update all references in all files using it.

- Move all other folders and files into the root of the main theme

- Merge the configurations from both `_config.yml` files
	- Again you can rename conflicting configurations (or merge duplicate ones) if you update all references.

- Fix all references to not found images/css/... files in the blog theme. This is necessary because the original theme was assuming to run in the root directory, and now we moved it to a subdirectory `blog/`.
	- I found that the best way to do this is to run `jekyll build` and have a look at the generated output in the `_site` directory. From this you can learn what's wrong and fix it.

After this I could run `Jekyll serve` and everything worked flawlessly!

...

Wait...

...

Why are my portfolio posts also showing up in my blog?

...

Damn you Jekyll!

Turns out Jekyll does not support paginating categories and hence it will lump all posts it finds together, in my case both portfolio (unwanted) and blog (wanted). Even more, there is no plugin to add this functionality either! Pretty weird, and a huge limitation if you ask me.

So I did what every self-respecting programmer would do: pray to the Stackoverflow and GitHub gods. And my prayers where answered by a code snippet of [benxtan](https://github.com/benxtan), which I found in an issue tracker of a very old [Jekyll pagination plugin](https://github.com/Painted-Fox/jekyll-category-pagination/issues/6). To enable this plugin, simply create a `_plugins` folder and copy the code snippet into a `category_pagination.rb` file.

>**Note**: the former plugin was no longer working, because it was referring to classes that were renamed/moved classes in newer Jekyll versions.

## GitHub and Jekyll plugins
My new shiny portfolio and blog were working locally, but when I pushed it to GitHub, the pagination again included both blog and portfolio posts. Turns out that GitHub doesn't allow you to run custom Jekyll plugins except for a few that they have whitelisted.

>**[Plugins on GitHub Pages](http://jekyllrb.com/docs/plugins/)**
>
>GitHub Pages is powered by Jekyll. However, all Pages sites are generated using the --safe option to disable custom plugins for security reasons. Unfortunately, this means your plugins won’t work if you’re deploying to GitHub Pages.

At this point, I am/was completely stuck, because even if Jekyll would add support for category pagination, I would still need to wait for GitHub to update their Jekyll version.

Only option remaining was to directly push the generated `_site` directory into my repository and to disable the Jekyll generator on GitHub pages.

>Note that this is a really suboptimal solution, because this effectively means pushing a high amount of auto-generated files to your repo, frequently. So if anyone has a better suggestion to solve the pagination issue, please let me know!

To make this work, there are a couple of things you need to do:

- Disable Jekyll on GitHub pages by pushing an empty file with name `.nojekyll` to the root of your repo

- Move all auto generated content from the `_site` folder into the root of your repository, so that its `index.html` is displayed when someone browses to your main page.

This actually by itself imposes a new problem, namely where to put your Jekyll source code? I solved this by:

- move all source files to a subfolder `jekyll-source` in my main repository

- generating all static pages into `jekyll-source/_site` using `jekyll build`

- removing all files and folders from my root directory, except for the `jekyll-source` directory

- copying the entire content of `jekyll-source/_site` into my root folder

I know this is not a great solution, but it gets the job done, and I was able to automate all of this in a [release script](https://github.com/JeroenMols/jeroenmols.github.io/blob/master/jekyll-code/release) that you can run by calling `.release` from the `jekyll-source` folder.

>**Note**: I also considered two other options:
>
>- Use a `CNAME` file to redirect my main url into a subfolder. This does not work, as the `CNAME` file can only be used for top-level domains.
>- Use a placeholder `index.html` which redirect the main url into a subfolder.
>
>I didn't use any of those mechanisms as that would unnecessarily complicate my website url.


## Protips
If you really want to make your site look spectacular:

- Site icon: add the following to the head of your `index.html` page:
`<link rel="favicon-144-precomposed" sizes="144x144" href="<link_to_your_icon>">`

- Site toolbar/status bar color on Android: add the following to the head of your `index.html` page: `<meta name="theme-color" content="<your_color_hex>">`


## Conclusion
I'm glad that I finally got my portfolio and blog up and running. My current solution might not be the best one in the world, but it is automated, maintainable and I can easily add blog posts in the future. Don't hesitate to look at my [GitHub repo](https://github.com/JeroenMols/jeroenmols.github.io) for the full source code. Hopefully the code and my post can help others to setup the same in the future.

Would I use Jekyll again if I would start over? Probably yes.

The only real limitation I ran into was due to the paginator combining the posts from both my portfolio and blog. This caused me to disable Jekyll completely and push the generated site directly to GitHub pages. While this really sucked, using another static site generator would also have forced me to do this (because GitHub only supports Jekyll). Furthermore combining two themes is already quite advanced, and if you stick to just one theme Jekyll is actually very convenient to use.
</p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong></strong>
                                </li>
                                <li>Download:
                                    <strong><a href=></a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-landscapevideocamera" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>LandscapeVideoCamera</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/LandscapeVideoCamera_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=https://github.com/JeroenMols/LandscapeVideoCamera>JMols Mobile</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>December 2014</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.jmolsmobile.landscapevideocapture_sample>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-saecoavanti" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Saeco Avanti Espresso Machine</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/SaecoAvanti_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.philips.com>Royal Philips</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>September 2014</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.philips.cl.di.saecoavanti>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-lightingpos" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Lighting Point of Sale</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/HuePos_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.philips.com>Royal Philips</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>July 2014</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.philips.pins.poshue>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-smartair" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Philips Smart Air</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/SmartAir_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.philips.com>Royal Philips</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>February 2014</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.philips.cl.di.dev.pa>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-eventapp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Event App Platform</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/eventapp_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=>Personal app</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>December 2013</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.jmolsmobile.brittenjeroen>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-tomorrowland" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Tomorrowland Radio</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/Tomorrowland_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.tomorrowland.com/>Tomorrowland</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>November 2013</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.tomorrowland.tomorrowland>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-airstudio" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>AirStudio+</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/AirStudio_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://www.woox.com/en/home>Woox innovations</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>April 2013</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.philips.airstudioplus>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-wifiletransfer" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>Wi-FileTransfer</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/WiFileTransfer_poster.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=http://wi-filetransfer.blogspot.be/>JMols Mobile</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>November 2012</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=https://play.google.com/store/apps/details?id=com.jmols.wi_filetransfer>Google Play</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portfolio-modal modal fade" id="portfolioModal-videobox" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2>VideoBox</h2>
                            <hr class="star-primary">
                            <img src="img/portfolio/Videodagboek_onepager.jpg" class="img-responsive img-centered" alt="image-alt">
                            <p></p>

                            <ul class="list-inline item-details">
                                <li>Client:
                                    <strong><a href=https://be.linkedin.com/pub/jeroen-mols/25/a62/995>JMols Mobile</a>
                                    </strong>
                                </li>
                                <li>Date:
                                    <strong>June 2010</strong>
                                </li>
                                <li>Download:
                                    <strong><a href=>/</a>
                                    </strong>
                                </li>
                            </ul>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

     <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/js/jqBootstrapValidation.js"></script>
    
    <script src="/js/contact_me_static.js"></script>
    

    <!-- Custom Theme JavaScript -->
    <script src="/js/freelancer.js"></script>

    </body>
</html>

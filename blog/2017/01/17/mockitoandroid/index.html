<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

	<meta name="theme-color" content="#2c3e50">
  	<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Using Mockito 2.x on Android &middot; Jeroen Mols
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Fonts -->
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

  <!-- Icons -->
  <link rel="favicon-144-precomposed" sizes="144x144" href="http://jeroenmols.com/favicon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://jeroenmols.com/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63356566-1', 'auto');
  ga('send', 'pageview');

</script>

  	<body class="theme-base-custom">
	    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about sidebar-title">

      <img class="img-responsive" src="/img/profile_round.png" alt="">

      <h1>
        <a class="sidebar-link" href="/blog">
          Jeroen Mols
        </a>
      </h1>

      <ul class="list-inline">
        
          <li>
              <a href="https://twitter.com/molsjeroen" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-twitter"></i></a>
          </li>
        
          <li>
              <a href="https://stackoverflow.com/users/2771851/jmols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-stack-overflow"></i></a>
          </li>
        
          <li>
              <a href="https://github.com/JeroenMols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-github"></i></a>
          </li>
        
          <li>
              <a href="https://be.linkedin.com/pub/jeroen-mols/25/a62/995" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-linkedin"></i></a>
          </li>
        
          <li>
              <a href="https://speakerdeck.com/jeroenmols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-file-pdf-o"></i></a>
          </li>
        
          <li>
              <a href="https://feeds.feedburner.com/JeroenMols" class="btn-social btn-outline" target="blank"><i class="fa fa-fw fa-rss"></i></a>
          </li>
        
      </ul>

      <p class="sidebar-subtitle">Android developer with a great <a class="sidebar-link" href="/">portfolio</a>.</p>
    </div>

    <div class="copyright">
      <p>Copyright &copy; Jeroen Mols 2017</p>
    </div>
  </div>
</div>

	    <div class="content container">
	      	<div class="post">
  <h1 class="post-title">Using Mockito 2.x on Android</h1>
  <span class="post-date">17 Jan 2017</span>

  
   <img src="/img/blog/mockitoandroid/mockitoandroid.png" alt="Using Mockito 2.x on Android" title="Android logo by Google, https://creativecommons.org/licenses/by/3.0/, cropped. Mockito logo, https://github.com/mockito/mockito, unmodified.">
  

  <p>The Mockito team is on fire lately! Not only did they add support to mock final classes and methods, but now they allow running Mockito directly onto an actual Android device.</p>

<p>Time to convert our Mockito 1.x projects to 2.x!</p>

<p><br></p>

<h2>History</h2>

<p>It has always been possible to run Mockito on Android devices and emulators. This however required using a tool called <code>Dexmaker</code> to help Mockito generate classes in the Android virtual machine.</p>

<p>While this approach worked fine, there was one big caveat: <code>Dexmaker</code> wasn&#39;t actively maintained. Consequently it was only compatible with Mockito 1.x so you couldn&#39;t use the new stuff while running tests on an Android device.</p>

<p>Further this extra dependency made your <code>build.gradle</code> look like this:</p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="n">testCompile</span> <span class="s1">&#39;org.mockito:mockito-core:2.6.3&#39;</span>

    <span class="n">androidTestCompile</span> <span class="s1">&#39;org.mockito:mockito-core:1.10.19&#39;</span>
    <span class="n">androidTestCompile</span> <span class="s1">&#39;com.crittercism.dexmaker:dexmaker:1.4&#39;</span>
    <span class="n">androidTestCompile</span> <span class="s1">&#39;com.crittercism.dexmaker:dexmaker-dx:1.4&#39;</span>
    <span class="n">androidTestCompile</span> <span class="s1">&#39;com.crittercism.dexmaker:dexmaker-mockito:1.4&#39;</span>
<span class="o">}</span>
</code></pre></div>
<p>Notice the 2.x version for the unit tests and the 1.x version for the instrumentation tests.</p>

<p>Fortunately, Mockito 2.6.0 changed that:</p>

<p><center><blockquote class="twitter-tweet" data-lang="nl"><p lang="en" dir="ltr">We have just released Mockito 2.6 with native support for Android. On Android, just use the mockito-android dependency. Test code stays!</p>&mdash; Rafael Winterhalter (@rafaelcodes) <a href="https://twitter.com/rafaelcodes/status/819525418231496705">12 januari 2017</a></blockquote></center></p>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><br></p>

<h2>Mockito 2.6.0+</h2>

<p>The latest release added a new artifact <code>mockito-android</code> next to the existing <code>mockito-core</code> artifact.</p>

<p>So to convert your existing instrumentation tests, just remove the <code>Dexmaker</code> dependencies and replace the <code>mockito-core</code> dependency with its <code>mockito-android</code> equivalent:</p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="n">testCompile</span> <span class="s1">&#39;org.mockito:mockito-core:2.6.3&#39;</span>

    <span class="n">androidTestCompile</span> <span class="s1">&#39;org.mockito:mockito-android:2.6.3&#39;</span>
<span class="o">}</span>
</code></pre></div>
<p>Simple, elegant and future proof!</p>

<p>Finally, please be aware that Mockito 2.x has some <a href="https://github.com/mockito/mockito/wiki/What%27s-new-in-Mockito-2#incompatible">behavior changes</a>. The one you&#39;re most likely going to run into while migrating is that <code>anyX()</code> and <code>any(SomeType.class)</code> matchers now reject null values.</p>

<p><br></p>

<h2>Wrap-up</h2>

<p>Finally Mockito has first class support for Android instrumentation tests! I&#39;ve also updated my <a href="https://github.com/jeroenmols/mockitoexample">Mockito sample project</a> where you can see how it works and learn more about how to use Mockito.</p>

<p>As always you can reach me <a href="https://twitter.com/molsjeroen">@molsjeroen</a> on twitter, or leave a comment below!</p>


  <div class="social-follow">
    <a href="https://twitter.com/intent/user?screen_name=molsjeroen" rel="nofollow" class="twitter">
      <i class="fa fa-twitter"></i><span id="social-span"> Follow @molsjeroen</span>
    </a>
</div>

</div>

<div class="social-share">
  <h2>Share on</h2>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=Using Mockito 2.x on Android&url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/&via=molsjeroen&related=molsjeroen&hashtags=androiddev"
        onclick="window.open(
              'https://twitter.com/intent/tweet?text=Using Mockito 2.x on Android&url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/&via=molsjeroen&related=molsjeroen&hashtags=androiddev'
          ,'popup','width=600,height=600'); return false;" class="twitter" title="Share on Twitter" rel="nofollow" target="popup">
          <i class="fa fa-twitter"></i><span id="social-span"> Twitter</span>
      </a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/"
        onclick="window.open(
              'https://www.facebook.com/sharer/sharer.php?u=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/'
          ,'popup','width=600,height=600'); return false;" class="facebook" title="Share on Facebook" rel="nofollow" target="popup">
          <i class="fa fa-facebook"></i><span id="social-span"> Facebook</span></a>
      </a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/"
        onclick="window.open(
              'https://plus.google.com/share?url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/'
          ,'popup','width=600,height=600'); return false;" class="google-plus" title="Share on Google Plus" rel="nofollow" target="popup">
          <i class="fa fa-google-plus"></i><span id="social-span"> Google+</span></a>
      </a>
    </li>
    <!-- <li>
      <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/&title=Using Mockito 2.x on Android&summary=&source=http://jeroenmols.com"
        onclick="window.open(
              'http://www.linkedin.com/shareArticle?mini=true&url=http://jeroenmols.com/blog/2017/01/17/mockitoandroid/&title=Using Mockito 2.x on Android&summary=&source=http://jeroenmols.com'
          ,'popup','width=600,height=600'); return false;" class="linkedin" title="Share on Google Plus" rel="nofollow" target="popup">
          <i class="fa fa-linkedin"></i><span id="social-span"> Linkedin</span></a>
      </a>
    </li> -->
  </ul>
</br></br>
</div><!-- /.social-share -->


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- bottom-blog-responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9854541518226004"
     data-ad-slot="4086741379"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



<h2>Comments</h2>
<section class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'jeroenmols';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</section>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      
        <li>
          <h3>
            <a href="/blog/2017/04/11/androidmakers17/">
              Android Makers FR recap
              <small>11 Apr 2017</small>
            </a>
          </h3>
        </li>
      
    
      
        <li>
          <h3>
            <a href="/blog/2017/03/08/appcrash/">
              Why your app should crash
              <small>08 Mar 2017</small>
            </a>
          </h3>
        </li>
      
    
      
        <li>
          <h3>
            <a href="/blog/2017/02/16/unittests/">
              Write awesome unit tests
              <small>16 Feb 2017</small>
            </a>
          </h3>
        </li>
      
    
  </ul>
</div>

	    </div>
  	</body>
</html>
